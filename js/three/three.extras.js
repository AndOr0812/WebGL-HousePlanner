THREE.FirstPersonControls=function(a,b){function c(a){a.preventDefault()}function e(a,b){return function(){b.apply(a,arguments)}}this.object=a;this.target=new THREE.Vector3(0,0,0);this.domElement=void 0!==b?b:document;this.enabled=!0;this.movementSpeed=1;this.lookSpeed=.005;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=
this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.viewHalfY=this.viewHalfX=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)};this.onMouseDown=function(a){this.domElement!==
document&&this.domElement.focus();a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(a){a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):
(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}};this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=
!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(a){if(!1!==this.enabled){if(this.heightSpeed){var b=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=a*b*this.heightCoef}else this.autoSpeedFactor=0;b=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(b+this.autoSpeedFactor));
this.moveBackward&&this.object.translateZ(b);this.moveLeft&&this.object.translateX(-b);this.moveRight&&this.object.translateX(b);this.moveUp&&this.object.translateY(b);this.moveDown&&this.object.translateY(-b);a*=this.lookSpeed;this.activeLook||(a=0);b=1;this.constrainVertical&&(b=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*a;this.lookVertical&&(this.lat-=this.mouseY*a*b);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(90-this.lat);this.theta=THREE.Math.degToRad(this.lon);
this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));a=this.target;b=this.object.position;a.x=b.x+100*Math.sin(this.phi)*Math.cos(this.theta);a.y=b.y+100*Math.cos(this.phi);a.z=b.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(a)}};this.dispose=function(){this.domElement.removeEventListener("contextmenu",c,!1);this.domElement.removeEventListener("mousedown",d,!1);this.domElement.removeEventListener("mousemove",f,!1);this.domElement.removeEventListener("mouseup",
k,!1);window.removeEventListener("keydown",l,!1);window.removeEventListener("keyup",r,!1)};var f=e(this,this.onMouseMove),d=e(this,this.onMouseDown),k=e(this,this.onMouseUp),l=e(this,this.onKeyDown),r=e(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",c,!1);this.domElement.addEventListener("mousemove",f,!1);this.domElement.addEventListener("mousedown",d,!1);this.domElement.addEventListener("mouseup",k,!1);window.addEventListener("keydown",l,!1);window.addEventListener("keyup",r,!1);
this.handleResize()};THREE.OrbitControls=function(a,b){function c(){return Math.pow(.95,g.zoomSpeed)}function e(a){g.object instanceof THREE.PerspectiveCamera?O/=a:g.object instanceof THREE.OrthographicCamera?(g.object.zoom=Math.max(g.minZoom,Math.min(g.maxZoom,g.object.zoom*a)),g.object.updateProjectionMatrix(),G=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1)}function f(a){g.object instanceof THREE.PerspectiveCamera?O*=a:g.object instanceof THREE.OrthographicCamera?
(g.object.zoom=Math.max(g.minZoom,Math.min(g.maxZoom,g.object.zoom/a)),g.object.updateProjectionMatrix(),G=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1)}function d(a){if(!1!==g.enabled){a.preventDefault();if(a.button===g.mouseButtons.ORBIT){if(!1===g.enableRotate)return;I.set(a.clientX,a.clientY);D=z.ROTATE}else if(a.button===g.mouseButtons.ZOOM){if(!1===g.enableZoom)return;V.set(a.clientX,a.clientY);D=z.DOLLY}else if(a.button===
g.mouseButtons.PAN){if(!1===g.enablePan)return;E.set(a.clientX,a.clientY);D=z.PAN}D!==z.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",l,!1),g.dispatchEvent(F))}}function k(a){!1!==g.enabled&&(a.preventDefault(),D===z.ROTATE?!1!==g.enableRotate&&(y.set(a.clientX,a.clientY),q.subVectors(y,I),a=g.domElement===document?g.domElement.body:g.domElement,C.theta-=2*Math.PI*q.x/a.clientWidth*g.rotateSpeed,C.phi-=2*Math.PI*q.y/a.clientHeight*g.rotateSpeed,I.copy(y),g.update()):
D===z.DOLLY?!1!==g.enableZoom&&(Q.set(a.clientX,a.clientY),J.subVectors(Q,V),0<J.y?e(c()):0>J.y&&f(c()),V.copy(Q),g.update()):D===z.PAN&&!1!==g.enablePan&&(w.set(a.clientX,a.clientY),K.subVectors(w,E),R(K.x,K.y),E.copy(w),g.update()))}function l(a){!1!==g.enabled&&(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",l,!1),g.dispatchEvent(A),D=z.NONE)}function r(a){!1===g.enabled||!1===g.enableZoom||D!==z.NONE&&D!==z.ROTATE||(a.preventDefault(),a.stopPropagation(),
0>a.deltaY?f(c()):0<a.deltaY&&e(c()),g.update(),g.dispatchEvent(F),g.dispatchEvent(A))}function h(a){if(!1!==g.enabled&&!1!==g.enableKeys&&!1!==g.enablePan)switch(a.keyCode){case g.keys.UP:R(0,g.keyPanSpeed);g.update();break;case g.keys.BOTTOM:R(0,-g.keyPanSpeed);g.update();break;case g.keys.LEFT:R(g.keyPanSpeed,0);g.update();break;case g.keys.RIGHT:R(-g.keyPanSpeed,0),g.update()}}function p(a){if(!1!==g.enabled){switch(a.touches.length){case 1:if(!1===g.enableRotate)return;I.set(a.touches[0].pageX,
a.touches[0].pageY);D=z.TOUCH_ROTATE;break;case 2:if(!1===g.enableZoom)return;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;V.set(0,Math.sqrt(b*b+a*a));D=z.TOUCH_DOLLY;break;case 3:if(!1===g.enablePan)return;E.set(a.touches[0].pageX,a.touches[0].pageY);D=z.TOUCH_PAN;break;default:D=z.NONE}D!==z.NONE&&g.dispatchEvent(F)}}function t(a){if(!1!==g.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===g.enableRotate)break;if(D!==z.TOUCH_ROTATE)break;
y.set(a.touches[0].pageX,a.touches[0].pageY);q.subVectors(y,I);var b=g.domElement===document?g.domElement.body:g.domElement;C.theta-=2*Math.PI*q.x/b.clientWidth*g.rotateSpeed;C.phi-=2*Math.PI*q.y/b.clientHeight*g.rotateSpeed;I.copy(y);g.update();break;case 2:if(!1===g.enableZoom)break;if(D!==z.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;Q.set(0,Math.sqrt(b*b+a*a));J.subVectors(Q,V);0<J.y?f(c()):0>J.y&&e(c());V.copy(Q);g.update();break;case 3:if(!1===
g.enablePan)break;if(D!==z.TOUCH_PAN)break;w.set(a.touches[0].pageX,a.touches[0].pageY);K.subVectors(w,E);R(K.x,K.y);E.copy(w);g.update();break;default:D=z.NONE}}function m(a){!1!==g.enabled&&(g.dispatchEvent(A),D=z.NONE)}function v(a){a.preventDefault()}this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=
-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=
function(){return n.phi};this.getAzimuthalAngle=function(){return n.theta};this.reset=function(){g.target.copy(g.target0);g.object.position.copy(g.position0);g.object.zoom=g.zoom0;g.object.updateProjectionMatrix();g.dispatchEvent(u);g.update();D=z.NONE};this.update=function(){var b=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),e=c.clone().inverse(),d=new THREE.Vector3,f=new THREE.Quaternion;return function(){var a=g.object.position;b.copy(a).sub(g.target);
b.applyQuaternion(c);n.setFromVector3(b);g.autoRotate&&D===z.NONE&&(C.theta-=2*Math.PI/60/60*g.autoRotateSpeed);n.theta+=C.theta;n.phi+=C.phi;n.theta=Math.max(g.minAzimuthAngle,Math.min(g.maxAzimuthAngle,n.theta));n.phi=Math.max(g.minPolarAngle,Math.min(g.maxPolarAngle,n.phi));n.makeSafe();n.radius*=O;n.radius=Math.max(g.minDistance,Math.min(g.maxDistance,n.radius));g.target.add(L);b.setFromSpherical(n);b.applyQuaternion(e);a.copy(g.target).add(b);g.object.lookAt(g.target);!0===g.enableDamping?(C.theta*=
1-g.dampingFactor,C.phi*=1-g.dampingFactor):C.set(0,0,0);O=1;L.set(0,0,0);return G||d.distanceToSquared(g.object.position)>M||8*(1-f.dot(g.object.quaternion))>M?(g.dispatchEvent(u),d.copy(g.object.position),f.copy(g.object.quaternion),G=!1,!0):!1}}();this.dispose=function(){g.domElement.removeEventListener("contextmenu",v,!1);g.domElement.removeEventListener("mousedown",d,!1);g.domElement.removeEventListener("wheel",r,!1);g.domElement.removeEventListener("touchstart",p,!1);g.domElement.removeEventListener("touchend",
m,!1);g.domElement.removeEventListener("touchmove",t,!1);document.removeEventListener("mousemove",k,!1);document.removeEventListener("mouseup",l,!1);window.removeEventListener("keydown",h,!1)};var g=this,u={type:"change"},F={type:"start"},A={type:"end"},z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},D=z.NONE,M=1E-6,n=new THREE.Spherical,C=new THREE.Spherical,O=1,L=new THREE.Vector3,G=!1,I=new THREE.Vector2,y=new THREE.Vector2,q=new THREE.Vector2,E=new THREE.Vector2,w=
new THREE.Vector2,K=new THREE.Vector2,V=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,U=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0);a.multiplyScalar(-b);L.add(a)}}(),aa=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1);a.multiplyScalar(b);L.add(a)}}(),R=function(){var a=new THREE.Vector3;return function(b,c){var e=g.domElement===document?g.domElement.body:g.domElement;if(g.object instanceof THREE.PerspectiveCamera){a.copy(g.object.position).sub(g.target);
var d=a.length(),d=d*Math.tan(g.object.fov/2*Math.PI/180);U(2*b*d/e.clientHeight,g.object.matrix);aa(2*c*d/e.clientHeight,g.object.matrix)}else g.object instanceof THREE.OrthographicCamera?(U(b*(g.object.right-g.object.left)/g.object.zoom/e.clientWidth,g.object.matrix),aa(c*(g.object.top-g.object.bottom)/g.object.zoom/e.clientHeight,g.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),g.enablePan=!1)}}();g.domElement.addEventListener("contextmenu",
v,!1);g.domElement.addEventListener("mousedown",d,!1);g.domElement.addEventListener("wheel",r,!1);g.domElement.addEventListener("touchstart",p,!1);g.domElement.addEventListener("touchend",m,!1);g.domElement.addEventListener("touchmove",t,!1);window.addEventListener("keydown",h,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;
Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");
return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");
return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");
return this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=a}}});var TransformConstrolsHighlighted=!1;
(function(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this);this.depthWrite=
this.depthTest=!1;this.transparent=!0;this.linewidth=5;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);b.prototype.constructor=b;new a({visible:!1,transparent:!1});THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;
this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c];
a=function(a,b){for(var e in a)for(c=a[e].length;c--;){var d=a[e][c][0],f=a[e][c][1],k=a[e][c][2];d.name=e;f&&d.position.set(f[0],f[1],f[2]);k&&d.rotation.set(k[0],k[1],k[2]);b.add(d)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.highlight=function(a){this.traverse(function(b){b.material&&
b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})};this.hide=function(){this.traverse(function(a){a.visible=!1})};this.show=function(){this.traverse(function(b){b.visible=!0;b.parent==a.pickers&&(b.visible=!1);b.parent==a.planes&&(b.visible=!1)});this.activePlane.visible=!1}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(a,b){var c=
new THREE.Vector3(0,0,0),e=new THREE.Vector3(0,1,0),k=new THREE.Matrix4;this.traverse(function(d){-1!==d.name.search("E")?d.quaternion.setFromRotationMatrix(k.lookAt(b,c,e)):-1==d.name.search("X")&&-1==d.name.search("Y")&&-1==d.name.search("Z")||d.quaternion.setFromEuler(a)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,e=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));e.position.y=.5;e.updateMatrix();c.merge(e.geometry,e.matrix);
e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var d=new THREE.BufferGeometry;d.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.6,0,0],[0,0,-Math.PI/2]],[new THREE.Line(e,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.6,0]],[new THREE.Line(f,
new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.6],[Math.PI/2,0,0]],[new THREE.Line(d,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.18,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.5,.5),new a({color:16776960,opacity:.25})),[.26,.26,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.5,.5),new a({color:65535,opacity:.25})),[0,.26,.26],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.5,
.5),new a({color:16711935,opacity:.25})),[.26,0,.26],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.18,0),
new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.6,.6),new a({color:16776960,opacity:.25})),[.26,.26,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.6,.6),new a({color:65535,opacity:.25})),[0,.26,.26],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.6,.6),new a({color:16711935,opacity:.25})),[.26,0,.26],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));
"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE);"XY"===a&&(this.activePlane=this.planes.XY);"YZ"===a&&(this.activePlane=this.planes.YZ);"XZ"===a&&(this.activePlane=this.planes.XZ);this.hide();
this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var c=function(a,b,c){var e=new THREE.BufferGeometry,d=[];c=c?c:1;for(var f=0;f<=64*c;++f)"x"===b&&d.push(0,Math.cos(f/32*Math.PI)*a,Math.sin(f/32*Math.PI)*a),"y"===b&&d.push(Math.cos(f/32*Math.PI)*a,0,Math.sin(f/32*Math.PI)*a),"z"===b&&
d.push(Math.sin(f/32*Math.PI)*a,Math.cos(f/32*Math.PI)*a,0);e.addAttribute("position",new THREE.Float32Attribute(d,3));return e};this.handleGizmos={X:[[new THREE.Line(new c(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new c(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new c(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new c(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new c(1,"z",1),new b({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,
.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:16776960,opacity:.25}))]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(a){"E"===
a&&(this.activePlane=this.planes.XYZE);"X"===a&&(this.activePlane=this.planes.YZ);"Y"===a&&(this.activePlane=this.planes.XZ);"Z"===a&&(this.activePlane=this.planes.XY);this.hide();this.show()};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,e=new THREE.Euler(0,0,1),f=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),h=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,0,1),t=new THREE.Quaternion,m=new THREE.Quaternion,v=new THREE.Quaternion,
g=b.clone();e.copy(this.planes.XY.rotation);f.setFromEuler(e);c.makeRotationFromQuaternion(f).getInverse(c);g.applyMatrix4(c);this.traverse(function(a){f.setFromEuler(e);"X"===a.name&&(t.setFromAxisAngle(r,Math.atan2(-g.y,g.z)),f.multiplyQuaternions(f,t),a.quaternion.copy(f));"Y"===a.name&&(m.setFromAxisAngle(h,Math.atan2(g.x,g.z)),f.multiplyQuaternions(f,m),a.quaternion.copy(f));"Z"===a.name&&(v.setFromAxisAngle(p,Math.atan2(g.y,g.x)),f.multiplyQuaternions(f,v),a.quaternion.copy(f))})};this.init()};
THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,e=new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.15));e.position.y=.5;e.updateMatrix();c.merge(e.geometry,e.matrix);e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var f=new THREE.BufferGeometry;f.addAttribute("position",
new THREE.Float32Attribute([0,0,0,0,1,0],3));var d=new THREE.BufferGeometry;d.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(e,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(f,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(d,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,
.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]};
this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE);this.hide();
this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(a,b){function c(a){if(void 0!==h.object&&!0!==t&&(void 0===a.button||0===a.button)){a.preventDefault();var b=r(a.changedTouches?a.changedTouches[0]:a,m[p].pickers.children),c=null;b&&(c=b.object.name,a.preventDefault());h.axis!==c&&(h.axis=c,h.update(),h.dispatchEvent(u))}}function d(a){if(void 0!==
h.object&&!0!==t&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var c=r(b,m[p].pickers.children);c&&(a.preventDefault(),a.stopPropagation(),h.dispatchEvent(F),h.axis=c.object.name,h.update(),y.copy(fa).sub(S).normalize(),m[p].setActivePlane(h.axis,y),a=r(b,[m[p].activePlane]))&&(ca.copy(h.object.position),P.copy(h.object.scale),ea.extractRotation(h.object.matrix),B.extractRotation(h.object.matrixWorld),Y.extractRotation(h.object.parent.matrixWorld),
Z.setFromMatrixScale(q.getInverse(h.object.parent.matrixWorld)),C.copy(a.point))}t=!0}}function e(a){if(void 0!==h.object&&null!==h.axis&&!1!==t&&(void 0===a.button||0===a.button)){var b=r(a.changedTouches?a.changedTouches[0]:a,[m[p].activePlane]);if(!1!==b){a.preventDefault();a.stopPropagation();n.copy(b.point);if("translate"===p){n.sub(C);n.multiply(Z);"local"===h.space&&(n.applyMatrix4(q.getInverse(B)),-1===h.axis.search("X")&&(n.x=0),-1===h.axis.search("Y")&&(n.y=0),-1===h.axis.search("Z")&&(n.z=
0),n.applyMatrix4(ea),h.object.position.copy(ca),h.object.position.add(n));if("world"===h.space||-1!==h.axis.search("XYZ"))-1===h.axis.search("X")&&(n.x=0),-1===h.axis.search("Y")&&(n.y=0),-1===h.axis.search("Z")&&(n.z=0),n.applyMatrix4(q.getInverse(Y)),h.object.position.copy(ca),h.object.position.add(n);null!==h.snap&&(-1!==h.axis.search("X")&&(h.object.position.x=Math.round(h.object.position.x/h.snap)*h.snap),-1!==h.axis.search("Y")&&(h.object.position.y=Math.round(h.object.position.y/h.snap)*h.snap),
-1!==h.axis.search("Z")&&(h.object.position.z=Math.round(h.object.position.z/h.snap)*h.snap))}else"scale"===p?(n.sub(C),n.multiply(Z),"local"===h.space&&("XYZ"===h.axis?(G=1+n.y/50,h.object.scale.x=P.x*G,h.object.scale.y=P.y*G,h.object.scale.z=P.z*G):(n.applyMatrix4(q.getInverse(B)),"X"===h.axis&&(h.object.scale.x=P.x*(1+n.x/50)),"Y"===h.axis&&(h.object.scale.y=P.y*(1+n.y/50)),"Z"===h.axis&&(h.object.scale.z=P.z*(1+n.z/50))))):"rotate"===p&&(n.sub(S),n.multiply(Z),E.copy(C).sub(S),E.multiply(Z),"E"===
h.axis?(n.applyMatrix4(q.getInverse(I)),E.applyMatrix4(q.getInverse(I)),O.set(Math.atan2(n.z,n.y),Math.atan2(n.x,n.z),Math.atan2(n.y,n.x)),L.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),w.setFromRotationMatrix(q.getInverse(Y)),X.setFromAxisAngle(y,O.z-L.z),J.setFromRotationMatrix(B),w.multiplyQuaternions(w,X),w.multiplyQuaternions(w,J),h.object.quaternion.copy(w)):"XYZE"===h.axis?(X.setFromEuler(n.clone().cross(E).normalize()),w.setFromRotationMatrix(q.getInverse(Y)),U.setFromAxisAngle(X,
-n.clone().angleTo(E)),J.setFromRotationMatrix(B),w.multiplyQuaternions(w,U),w.multiplyQuaternions(w,J),h.object.quaternion.copy(w)):"local"===h.space?(n.applyMatrix4(q.getInverse(B)),E.applyMatrix4(q.getInverse(B)),O.set(Math.atan2(n.z,n.y),Math.atan2(n.x,n.z),Math.atan2(n.y,n.x)),L.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),J.setFromRotationMatrix(ea),U.setFromAxisAngle(K,O.x-L.x),aa.setFromAxisAngle(V,O.y-L.y),R.setFromAxisAngle(Q,O.z-L.z),"X"===h.axis&&J.multiplyQuaternions(J,
U),"Y"===h.axis&&J.multiplyQuaternions(J,aa),"Z"===h.axis&&J.multiplyQuaternions(J,R),h.object.quaternion.copy(J)):"world"===h.space&&(O.set(Math.atan2(n.z,n.y),Math.atan2(n.x,n.z),Math.atan2(n.y,n.x)),L.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),w.setFromRotationMatrix(q.getInverse(Y)),U.setFromAxisAngle(K,O.x-L.x),aa.setFromAxisAngle(V,O.y-L.y),R.setFromAxisAngle(Q,O.z-L.z),J.setFromRotationMatrix(B),"X"===h.axis&&w.multiplyQuaternions(w,U),"Y"===h.axis&&w.multiplyQuaternions(w,
aa),"Z"===h.axis&&w.multiplyQuaternions(w,R),w.multiplyQuaternions(w,J),h.object.quaternion.copy(w)));h.update();h.dispatchEvent(u);h.dispatchEvent(z)}}}function l(a){if(void 0===a.button||0===a.button)t&&null!==h.axis&&(A.mode=p,h.dispatchEvent(A)),t=!1,c(a)}function r(c,d){var e=b.getBoundingClientRect();M.set((c.clientX-e.left)/e.width*2-1,-((c.clientY-e.top)/e.height*2)+1);D.setFromCamera(M,a);e=D.intersectObjects(d,!0);TransformConstrolsHighlighted=0<e.length?!0:!1;return e[0]?e[0]:!1}THREE.Object3D.call(this);
b=void 0!==b?b:document;this.object=void 0;this.visible=!1;this.snap=null;this.space="world";this.size=1;this.axis=null;var h=this,p="translate",t=!1,m={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale},v;for(v in m){var g=m[v];g.visible=v===p;this.add(g)}var u={type:"change"},F={type:"mouseDown"},A={type:"mouseUp",mode:p},z={type:"objectChange"},D=new THREE.Raycaster,M=new THREE.Vector2,n=new THREE.Vector3,C=new THREE.Vector3,O=
new THREE.Vector3,L=new THREE.Vector3,G=1,I=new THREE.Matrix4,y=new THREE.Vector3,q=new THREE.Matrix4,E=new THREE.Vector3,w=new THREE.Quaternion,K=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),Q=new THREE.Vector3(0,0,1),J=new THREE.Quaternion,U=new THREE.Quaternion,aa=new THREE.Quaternion,R=new THREE.Quaternion,X=new THREE.Quaternion,ca=new THREE.Vector3,P=new THREE.Vector3,ea=new THREE.Matrix4,Y=new THREE.Matrix4,Z=new THREE.Vector3,S=new THREE.Vector3,ga=new THREE.Euler,B=new THREE.Matrix4,
fa=new THREE.Vector3,ha=new THREE.Euler;b.addEventListener("mousedown",d,!1);b.addEventListener("touchstart",d,!1);b.addEventListener("mousemove",c,!1);b.addEventListener("touchmove",c,!1);b.addEventListener("mousemove",e,!1);b.addEventListener("touchmove",e,!1);b.addEventListener("mouseup",l,!1);b.addEventListener("mouseout",l,!1);b.addEventListener("touchend",l,!1);b.addEventListener("touchcancel",l,!1);b.addEventListener("touchleave",l,!1);this.dispose=function(){b.removeEventListener("mousedown",
d);b.removeEventListener("touchstart",d);b.removeEventListener("mousemove",c);b.removeEventListener("touchmove",c);b.removeEventListener("mousemove",e);b.removeEventListener("touchmove",e);b.removeEventListener("mouseup",l);b.removeEventListener("mouseout",l);b.removeEventListener("touchend",l);b.removeEventListener("touchcancel",l);b.removeEventListener("touchleave",l)};this.attach=function(a){this.object=a;this.visible=!0;this.update()};this.detach=function(a){this.object=void 0;this.visible=!1;
this.axis=null;TransformConstrolsHighlighted=!1};this.setMode=function(a){p=a?a:p;"scale"===p&&(h.space="local");for(var b in m)m[b].visible=b===p;this.update();h.dispatchEvent(u)};this.setTranslationSnap=function(a){h.translationSnap=a};this.setRotationSnap=function(a){h.rotationSnap=a};this.setSize=function(a){h.size=a;this.update();h.dispatchEvent(u)};this.setSpace=function(a){h.space=a;this.update();h.dispatchEvent(u)};this.update=function(){void 0!==h.object&&(h.object.updateMatrixWorld(),S.setFromMatrixPosition(h.object.matrixWorld),
ga.setFromRotationMatrix(q.extractRotation(h.object.matrixWorld)),a.updateMatrixWorld(),fa.setFromMatrixPosition(a.matrixWorld),ha.setFromRotationMatrix(q.extractRotation(a.matrixWorld)),G=S.distanceTo(fa)/6*h.size,this.position.copy(S),this.scale.set(G,G,G),y.copy(fa).sub(S).normalize(),"local"===h.space?m[p].update(ga,y):"world"===h.space&&m[p].update(new THREE.Euler,y),m[p].highlight(h.axis))}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=
THREE.TransformControls})();var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";
a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return a},addGetWebGLMessage:function(a){var b,c;a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}};"object"===typeof module&&(module.exports=Detector);THREE.GeometryExporter=function(){};
THREE.GeometryExporter.prototype={constructor:THREE.GeometryExporter,parse:function(a){function b(a,b,c){return c?a|1<<b:a&~(1<<b)}function c(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==p[b])return p[b];p[b]=h.length/3;h.push(a.x,a.y,a.z);return p[b]}function e(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==m[b])return m[b];m[b]=t.length;t.push(a.getHex());return m[b]}function f(a){var b=a.x.toString()+a.y.toString();if(void 0!==g[b])return g[b];g[b]=v.length/
2;v.push(a.x,a.y);return g[b]}for(var d={metadata:{version:4,type:"geometry",generator:"GeometryExporter"}},k=[],l=0;l<a.vertices.length;l++){var r=a.vertices[l];k.push(r.x,r.y,r.z)}for(var r=[],h=[],p={},t=[],m={},v=[],g={},l=0;l<a.faces.length;l++){var u=a.faces[l],F=void 0!==a.faceVertexUvs[0][l],A=0<u.normal.length(),z=0<u.vertexNormals.length,D=1!==u.color.r||1!==u.color.g||1!==u.color.b,M=0<u.vertexColors.length,n=0,n=b(n,0,0),n=b(n,1,!1),n=b(n,2,!1),n=b(n,3,F),n=b(n,4,A),n=b(n,5,z),n=b(n,6,
D),n=b(n,7,M);r.push(n);r.push(u.a,u.b,u.c);F&&(F=a.faceVertexUvs[0][l],r.push(f(F[0]),f(F[1]),f(F[2])));A&&r.push(c(u.normal));z&&(A=u.vertexNormals,r.push(c(A[0]),c(A[1]),c(A[2])));D&&r.push(e(u.color));M&&(u=u.vertexColors,r.push(e(u[0]),e(u[1]),e(u[2])))}d.vertices=k;d.normals=h;0<t.length&&(d.colors=t);0<v.length&&(d.uvs=[v]);d.faces=r;return d}};THREE.MaterialExporter=function(){};
THREE.MaterialExporter.prototype={constructor:THREE.MaterialExporter,parse:function(a){var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"}};b.uuid=a.uuid;""!==a.name&&(b.name=a.name);if(a instanceof THREE.MeshBasicMaterial)b.type="MeshBasicMaterial",b.color=a.color.getHex(),a.vertexColors!==THREE.NoColors&&(b.vertexColors=a.vertexColors),a.blending!==THREE.NormalBlending&&(b.blending=a.blending),a.side!==THREE.FrontSide&&(b.side=a.side),b.opacity=a.opacity,b.transparent=a.transparent,
b.wireframe=a.wireframe;else if(a instanceof THREE.MeshLambertMaterial)b.type="MeshLambertMaterial",b.color=a.color.getHex(),b.ambient=a.ambient.getHex(),b.emissive=a.emissive.getHex(),a.vertexColors!==THREE.NoColors&&(b.vertexColors=a.vertexColors),a.blending!==THREE.NormalBlending&&(b.blending=a.blending),a.side!==THREE.FrontSide&&(b.side=a.side),b.opacity=a.opacity,b.transparent=a.transparent,b.wireframe=a.wireframe;else if(a instanceof THREE.MeshPhongMaterial)b.type="MeshPhongMaterial",b.color=
a.color.getHex(),b.ambient=a.ambient.getHex(),b.emissive=a.emissive.getHex(),b.specular=a.specular.getHex(),b.shininess=a.shininess,a.vertexColors!==THREE.NoColors&&(b.vertexColors=a.vertexColors),a.blending!==THREE.NormalBlending&&(b.blending=a.blending),a.side!==THREE.FrontSide&&(b.side=a.side),b.opacity=a.opacity,b.transparent=a.transparent,b.wireframe=a.wireframe;else if(a instanceof THREE.MeshNormalMaterial)b.type="MeshNormalMaterial",a.blending!==THREE.NormalBlending&&(b.blending=a.blending),
a.side!==THREE.FrontSide&&(b.side=a.side),b.opacity=a.opacity,b.transparent=a.transparent,b.wireframe=a.wireframe;else if(a instanceof THREE.MeshDepthMaterial)b.type="MeshDepthMaterial",a.blending!==THREE.NormalBlending&&(b.blending=a.blending),a.side!==THREE.FrontSide&&(b.side=a.side),b.opacity=a.opacity,b.transparent=a.transparent,b.wireframe=a.wireframe;else if(a instanceof THREE.MeshFaceMaterial){b.type="MeshFaceMaterial";b.materials=[];for(var c=0,e=a.materials.length;c<e;c++)b.materials.push(this.parse(a.materials[c]))}else a instanceof
THREE.ShaderMaterial?(b.type="ShaderMaterial",b.uniforms=a.uniforms,b.vertexShader=a.vertexShader,b.fragmentShader=a.fragmentShader):a instanceof THREE.SpriteMaterial&&(b.type="SpriteMaterial",b.color=a.color.getHex(),b.opacity=a.opacity,b.transparent=a.transparent);return b}};THREE.ObjectExporter=function(){};
THREE.ObjectExporter.prototype={constructor:THREE.ObjectExporter,parse:function(a){var b={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},c={},e=new THREE.GeometryExporter,f=new THREE.BufferGeometryExporter,d=function(a){void 0===b.geometries&&(b.geometries=[]);if(void 0===c[a.uuid]){var d={};d.uuid=a.uuid;""!==a.name&&(d.name=a.name);var h=function(b){for(var c=0;c<b.length;c++){var e=b[c];void 0!==a.parameters[e]&&(d[e]=a.parameters[e])}};a instanceof THREE.PlaneGeometry?(d.type=
"PlaneGeometry",h(["width","height","widthSegments","heightSegments"])):a instanceof THREE.BoxGeometry?(d.type="BoxGeometry",h("width height depth widthSegments heightSegments depthSegments".split(" "))):a instanceof THREE.CircleGeometry?(d.type="CircleGeometry",h(["radius","segments"])):a instanceof THREE.CylinderGeometry?(d.type="CylinderGeometry",h("radiusTop radiusBottom height radialSegments heightSegments openEnded".split(" "))):a instanceof THREE.SphereGeometry?(d.type="SphereGeometry",h("radius widthSegments heightSegments phiStart phiLength thetaStart thetaLength".split(" "))):
a instanceof THREE.IcosahedronGeometry?(d.type="IcosahedronGeometry",h(["radius","detail"])):a instanceof THREE.TorusGeometry?(d.type="TorusGeometry",h(["radius","tube","radialSegments","tubularSegments","arc"])):a instanceof THREE.TorusKnotGeometry?(d.type="TorusKnotGeometry",h("radius tube radialSegments tubularSegments p q heightScale".split(" "))):a instanceof THREE.BufferGeometry?(d.type="BufferGeometry",d.data=f.parse(a),delete d.data.metadata):a instanceof THREE.Geometry&&(d.type="Geometry",
d.data=e.parse(a),delete d.data.metadata);c[a.uuid]=d;b.geometries.push(d)}return a.uuid},k={},l=new THREE.MaterialExporter,r=function(a){void 0===b.materials&&(b.materials=[]);if(void 0===k[a.uuid]){var c=l.parse(a);delete c.metadata;k[a.uuid]=c;b.materials.push(c)}return a.uuid},h=function(a){var b={};b.uuid=a.uuid;""!==a.name&&(b.name=a.name);"{}"!==JSON.stringify(a.userData)&&(b.userData=a.userData);!0!==a.visible&&(b.visible=a.visible);a instanceof THREE.Scene?b.type="Scene":a instanceof THREE.PerspectiveCamera?
(b.type="PerspectiveCamera",b.fov=a.fov,b.aspect=a.aspect,b.near=a.near,b.far=a.far):a instanceof THREE.OrthographicCamera?(b.type="OrthographicCamera",b.left=a.left,b.right=a.right,b.top=a.top,b.bottom=a.bottom,b.near=a.near,b.far=a.far):a instanceof THREE.AmbientLight?(b.type="AmbientLight",b.color=a.color.getHex()):a instanceof THREE.DirectionalLight?(b.type="DirectionalLight",b.color=a.color.getHex(),b.intensity=a.intensity):a instanceof THREE.PointLight?(b.type="PointLight",b.color=a.color.getHex(),
b.intensity=a.intensity,b.distance=a.distance):a instanceof THREE.SpotLight?(b.type="SpotLight",b.color=a.color.getHex(),b.intensity=a.intensity,b.distance=a.distance,b.angle=a.angle,b.exponent=a.exponent):a instanceof THREE.HemisphereLight?(b.type="HemisphereLight",b.color=a.color.getHex(),b.groundColor=a.groundColor.getHex()):a instanceof THREE.Mesh?(b.type="Mesh",b.geometry=d(a.geometry),b.material=r(a.material)):a instanceof THREE.Sprite?(b.type="Sprite",b.material=r(a.material)):b.type="Object3D";
b.matrix=a.matrix.toArray();if(0<a.children.length){b.children=[];for(var c=0;c<a.children.length;c++)b.children.push(h(a.children[c]))}return b};b.object=h(a);return b}};THREE.OBJExporter=function(){};
THREE.OBJExporter.prototype={constructor:THREE.OBJExporter,parse:function(a){var b="",c=0,e=0,f=0;a.traverse(function(a){if(a instanceof THREE.Mesh){var d=0,l=0,r=0,h=a.geometry;if(h instanceof THREE.Geometry){b+="o "+a.name+"\n";for(var p=h.vertices,t=0,m=p.length;t<m;t++){var v=p[t].clone();v.applyMatrix4(a.matrixWorld);b+="v "+v.x+" "+v.y+" "+v.z+"\n";d++}var p=h.faces,g=h.faceVertexUvs[0];if(h=p.length===g.length)for(t=0,m=g.length;t<m;t++)for(var u=g[t],v=0,F=u.length;v<F;v++){var A=u[v];b+=
"vt "+A.x+" "+A.y+"\n";l++}g=new THREE.Matrix3;g.getNormalMatrix(a.matrixWorld);t=0;for(m=p.length;t<m;t++)if(F=p[t],a=F.vertexNormals,3===a.length)for(v=0,F=a.length;v<F;v++)u=a[v].clone(),u.applyMatrix3(g),b+="vn "+u.x+" "+u.y+" "+u.z+"\n",r++;else for(u=F.normal.clone(),u.applyMatrix3(g),v=0;3>v;v++)b+="vn "+u.x+" "+u.y+" "+u.z+"\n",r++;t=0;v=1;for(m=p.length;t<m;t++,v+=3)F=p[t],b+="f ",b+=c+F.a+1+"/"+(h?e+v:"")+"/"+(f+v)+" ",b+=c+F.b+1+"/"+(h?e+v+1:"")+"/"+(f+v+1)+" ",b+=c+F.c+1+"/"+(h?e+v+2:
"")+"/"+(f+v+2)+"\n"}else console.warn("THREE.OBJExporter.parseMesh(): geometry type unsupported",a);c+=d;e+=l;f+=r}});return b}};THREE.TypedGeometryExporter=function(){};THREE.TypedGeometryExporter.prototype={constructor:THREE.TypedGeometryExporter,parse:function(a){var b={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},c=["vertices","normals","uvs"],e;for(e in c){for(var f=c[e],d=a[f],k=[],l=0,r=d.length;l<r;l++)k[l]=d[l];b[f]=k}a=a.boundingSphere;null!==a&&(b.boundingSphere={center:a.center.toArray(),radius:a.radius});return b}};THREE.MTLLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.MTLLoader.prototype,THREE.EventDispatcher.prototype,{load:function(a,b,c,e){var f=this,d=new THREE.FileLoader(this.manager);d.setPath(this.path);d.load(a,function(a){b(f.parse(a))},c,e)},setPath:function(a){this.path=a},setTexturePath:function(a){this.texturePath=a},setBaseUrl:function(a){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.");this.setTexturePath(a)},setCrossOrigin:function(a){this.crossOrigin=
a},setMaterialOptions:function(a){this.materialOptions=a},parse:function(a){var b=a.split("\n"),c={},e=/\s+/;a={};for(var f=0;f<b.length;f++){var d=b[f],d=d.trim();if(0!==d.length&&"#"!==d.charAt(0)){var k=d.indexOf(" "),l=0<=k?d.substring(0,k):d,l=l.toLowerCase(),d=0<=k?d.substring(k+1):"",d=d.trim();"newmtl"===l?(c={name:d},a[d]=c):c&&("ka"===l||"kd"===l||"ks"===l?(d=d.split(e,3),c[l]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]):c[l]=d)}}b=new THREE.MTLLoader.MaterialCreator(this.texturePath||
this.path,this.materialOptions);b.setCrossOrigin(this.crossOrigin);b.setManager(this.manager);b.setMaterials(a);return b}});THREE.MTLLoader.MaterialCreator=function(a,b){this.baseUrl=a||"";this.options=b;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};
THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(a){this.crossOrigin=a},setManager:function(a){this.manager=a},setMaterials:function(a){this.materialsInfo=this.convert(a);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(a){if(!this.options)return a;var b={},c;for(c in a){var e=a[c],f={};b[c]=f;for(var d in e){var k=!0,l=e[d],r=d.toLowerCase();switch(r){case "kd":case "ka":case "ks":this.options&&this.options.normalizeRGB&&
(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===l[0]&&0===l[1]&&0===l[2]&&(k=!1)}k&&(f[r]=l)}}return b},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0,b;for(b in this.materialsInfo)this.materialsArray[a]=this.create(b),this.nameLookup[b]=a,a++;return this.materialsArray},create:function(a){void 0===this.materials[a]&&this.createMaterial_(a);return this.materials[a]},createMaterial_:function(a){function b(a,
b){if(!f[a]){var e=c.getTextureParams(b,f),h=c.loadTexture(d(c.baseUrl,e.url));h.repeat.copy(e.scale);h.offset.copy(e.offset);h.wrapS=c.wrap;h.wrapT=c.wrap;f[a]=h}}var c=this,e=this.materialsInfo[a],f={name:a,side:this.side},d=function(a,b){return"string"!==typeof b||""===b?"":/^https?:\/\//i.test(b)?b:a+b},k;for(k in e){var l=e[k];if(""!==l)switch(k.toLowerCase()){case "kd":f.color=(new THREE.Color).fromArray(l);break;case "ks":f.specular=(new THREE.Color).fromArray(l);break;case "map_kd":b("map",
l);break;case "map_ks":b("specularMap",l);break;case "map_bump":case "bump":b("bumpMap",l);break;case "ns":f.shininess=parseFloat(l);break;case "d":1>l&&(f.opacity=l,f.transparent=!0);break;case "Tr":0<l&&(f.opacity=1-l,f.transparent=!0)}}this.materials[a]=new THREE.MeshPhongMaterial(f);return this.materials[a]},getTextureParams:function(a,b){var c={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},e=a.split(/\s+/),f;f=e.indexOf("-bm");0<=f&&(b.bumpScale=parseFloat(e[f+1]),e.splice(f,2));
f=e.indexOf("-s");0<=f&&(c.scale.set(parseFloat(e[f+1]),parseFloat(e[f+2])),e.splice(f,4));f=e.indexOf("-o");0<=f&&(c.offset.set(parseFloat(e[f+1]),parseFloat(e[f+2])),e.splice(f,4));c.url=e.join(" ").trim();return c},loadTexture:function(a,b,c,e,f){var d=THREE.Loader.Handlers.get(a),k=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;null===d&&(d=new THREE.TextureLoader(k));d.setCrossOrigin&&d.setCrossOrigin(this.crossOrigin);a=d.load(a,c,e,f);void 0!==b&&(a.mapping=b);return a}};THREE.OBJLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.materials=null;this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,
face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(a,b,c,e){var f=this,d=new THREE.FileLoader(f.manager);d.setPath(this.path);d.load(a,function(a){b(f.parse(a))},c,e)},setPath:function(a){this.path=a},setMaterials:function(a){this.materials=a},_createParserState:function(){var a={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(a,c){if(this.object&&!1===this.object.fromDeclaration)this.object.name=a,this.object.fromDeclaration=!1!==c;else{var b=
this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0);this.object={name:a||"",fromDeclaration:!1!==c,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);c={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-
1]:"",smooth:void 0!==c?c.smooth:this.smooth,groupStart:void 0!==c?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){a={index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};a.clone=this.clone.bind(a);return a}};this.materials.push(c);return c},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(a){var b=this.currentMaterial();
b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1);if(a&&1<this.materials.length)for(var c=this.materials.length-1;0<=c;c--)0>=this.materials[c].groupCount&&this.materials.splice(c,1);a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth});return b}};b&&b.name&&"function"===typeof b.clone&&(b=b.clone(0),b.inherited=!0,this.object.materials.push(b));this.objects.push(this.object)}},finalize:function(){this.object&&
"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(a,c){var b=parseInt(a,10);return 3*(0<=b?b-1:b+c/3)},parseNormalIndex:function(a,c){var b=parseInt(a,10);return 3*(0<=b?b-1:b+c/3)},parseUVIndex:function(a,c){var b=parseInt(a,10);return 2*(0<=b?b-1:b+c/2)},addVertex:function(a,c,e){var b=this.vertices,d=this.object.geometry.vertices;d.push(b[a+0]);d.push(b[a+1]);d.push(b[a+2]);d.push(b[c+0]);d.push(b[c+1]);d.push(b[c+2]);d.push(b[e+0]);d.push(b[e+1]);
d.push(b[e+2])},addVertexLine:function(a){var b=this.vertices,e=this.object.geometry.vertices;e.push(b[a+0]);e.push(b[a+1]);e.push(b[a+2])},addNormal:function(a,c,e){var b=this.normals,d=this.object.geometry.normals;d.push(b[a+0]);d.push(b[a+1]);d.push(b[a+2]);d.push(b[c+0]);d.push(b[c+1]);d.push(b[c+2]);d.push(b[e+0]);d.push(b[e+1]);d.push(b[e+2])},addUV:function(a,c,e){var b=this.uvs,d=this.object.geometry.uvs;d.push(b[a+0]);d.push(b[a+1]);d.push(b[c+0]);d.push(b[c+1]);d.push(b[e+0]);d.push(b[e+
1])},addUVLine:function(a){var b=this.uvs,e=this.object.geometry.uvs;e.push(b[a+0]);e.push(b[a+1])},addFace:function(a,c,e,f,d,k,l,r,h,p,t,m){var b=this.vertices.length;a=this.parseVertexIndex(a,b);c=this.parseVertexIndex(c,b);e=this.parseVertexIndex(e,b);void 0===f?this.addVertex(a,c,e):(b=this.parseVertexIndex(f,b),this.addVertex(a,c,b),this.addVertex(c,e,b));void 0!==d&&(b=this.uvs.length,a=this.parseUVIndex(d,b),c=this.parseUVIndex(k,b),e=this.parseUVIndex(l,b),void 0===f?this.addUV(a,c,e):(b=
this.parseUVIndex(r,b),this.addUV(a,c,b),this.addUV(c,e,b)));void 0!==h&&(d=this.normals.length,a=this.parseNormalIndex(h,d),c=h===p?a:this.parseNormalIndex(p,d),e=h===t?a:this.parseNormalIndex(t,d),void 0===f?this.addNormal(a,c,e):(b=this.parseNormalIndex(m,d),this.addNormal(a,c,b),this.addNormal(c,e,b)))},addLineGeometry:function(a,c){this.object.geometry.type="Line";for(var b=this.vertices.length,f=this.uvs.length,d=0,k=a.length;d<k;d++)this.addVertexLine(this.parseVertexIndex(a[d],b));b=0;for(k=
c.length;b<k;b++)this.addUVLine(this.parseUVIndex(c[b],f))}};a.startObject("",!1);return a},parse:function(a){console.time("OBJLoader");var b=this._createParserState();-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n"));-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));var c=a.split("\n"),e,f,d=[],k="function"===typeof"".trimLeft;a=0;for(var l=c.length;a<l;a++)if(e=c[a],e=k?e.trimLeft():e.trim(),f=e.length,0!==f&&(f=e.charAt(0),"#"!==f))if("v"===f)if(f=e.charAt(1)," "===f&&null!==(d=this.regexp.vertex_pattern.exec(e)))b.vertices.push(parseFloat(d[1]),
parseFloat(d[2]),parseFloat(d[3]));else if("n"===f&&null!==(d=this.regexp.normal_pattern.exec(e)))b.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));else if("t"===f&&null!==(d=this.regexp.uv_pattern.exec(e)))b.uvs.push(parseFloat(d[1]),parseFloat(d[2]));else throw Error("Unexpected vertex/normal/uv line: '"+e+"'");else if("f"===f)if(null!==(d=this.regexp.face_vertex_uv_normal.exec(e)))b.addFace(d[1],d[4],d[7],d[10],d[2],d[5],d[8],d[11],d[3],d[6],d[9],d[12]);else if(null!==(d=this.regexp.face_vertex_uv.exec(e)))b.addFace(d[1],
d[3],d[5],d[7],d[2],d[4],d[6],d[8]);else if(null!==(d=this.regexp.face_vertex_normal.exec(e)))b.addFace(d[1],d[3],d[5],d[7],void 0,void 0,void 0,void 0,d[2],d[4],d[6],d[8]);else if(null!==(d=this.regexp.face_vertex.exec(e)))b.addFace(d[1],d[2],d[3],d[4]);else throw Error("Unexpected face line: '"+e+"'");else if("l"===f){f=e.substring(1).trim().split(" ");var r=[],h=[];if(-1===e.indexOf("/"))r=f;else{e=0;for(var p=f.length;e<p;e++){var t=f[e].split("/");""!==t[0]&&r.push(t[0]);""!==t[1]&&h.push(t[1])}}b.addLineGeometry(r,
h)}else if(null!==(d=this.regexp.object_pattern.exec(e)))e=(" "+d[0].substr(1).trim()).substr(1),b.startObject(e);else if(this.regexp.material_use_pattern.test(e))b.object.startMaterial(e.substring(7).trim(),b.materialLibraries);else if(this.regexp.material_library_pattern.test(e))b.materialLibraries.push(e.substring(7).trim());else if(null!==(d=this.regexp.smoothing_pattern.exec(e))){if(e=d[1].trim().toLowerCase(),b.object.smooth="1"===e||"on"===e,e=b.object.currentMaterial())e.smooth=b.object.smooth}else if("\x00"!==
e)throw Error("Unexpected line: '"+e+"'");b.finalize();c=new THREE.Group;c.materialLibraries=[].concat(b.materialLibraries);a=0;for(l=b.objects.length;a<l;a++)if(d=b.objects[a],e=d.geometry,r=d.materials,k="Line"===e.type,0!==e.vertices.length){f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e.vertices),3));0<e.normals.length?f.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(e.normals),3)):f.computeVertexNormals();0<e.uvs.length&&f.addAttribute("uv",
new THREE.BufferAttribute(new Float32Array(e.uvs),2));h=[];p=0;for(t=r.length;p<t;p++){var m=r[p];e=void 0;if(null!==this.materials&&(e=this.materials.create(m.name),k&&e&&!(e instanceof THREE.LineBasicMaterial))){var v=new THREE.LineBasicMaterial;v.copy(e);e=v}e||(e=k?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,e.name=m.name);e.shading=m.smooth?THREE.SmoothShading:THREE.FlatShading;h.push(e)}if(1<h.length){p=0;for(t=r.length;p<t;p++)m=r[p],f.addGroup(m.groupStart,m.groupCount,p);e=new THREE.MultiMaterial(h);
k=k?new THREE.LineSegments(f,e):new THREE.Mesh(f,e)}else k=k?new THREE.LineSegments(f,h[0]):new THREE.Mesh(f,h[0]);k.name=d.name;c.add(k)}console.timeEnd("OBJLoader");return c}};THREE.OBJMTLLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(a,b,c,e,f){var d=this,k=new THREE.MTLLoader(this.manager);k.setBaseUrl(a.substr(0,a.lastIndexOf("/")+1));k.setCrossOrigin(this.crossOrigin);k.load(b,function(b){b.preload();var k=new THREE.XHRLoader(d.manager);k.setCrossOrigin(d.crossOrigin);k.load(a,function(a){a=d.parse(a);a.traverse(function(a){if(a instanceof THREE.Mesh&&a.material.name){var c=b.create(a.material.name);c&&(a.material=c)}});c(a)},e,f)},e,f)},setCrossOrigin:function(a){this.crossOrigin=
a},parse:function(a,b){function c(a,b,c){return new THREE.Vector3(a,b,c)}function e(a,b){return new THREE.Vector2(a,b)}function f(a,b,c,d){return new THREE.Face3(a,b,c,d)}function d(a,b){0<u.length&&(m.vertices=u,m.mergeVertices(),m.computeFaceNormals(),m.computeBoundingSphere(),t.add(g),m=new THREE.Geometry,g=new THREE.Mesh(m,v));void 0!==a&&(g.name=a);void 0!==b&&(v=new THREE.MeshLambertMaterial,v.name=b,g.material=v)}function k(a,b,c,d){void 0===d?m.faces.push(f(parseInt(a)-(h+1),parseInt(b)-(h+
1),parseInt(c)-(h+1))):m.faces.push(f(parseInt(a)-(h+1),parseInt(b)-(h+1),parseInt(c)-(h+1),[F[parseInt(d[0])-1].clone(),F[parseInt(d[1])-1].clone(),F[parseInt(d[2])-1].clone()]))}function l(a,b,c){m.faceVertexUvs[0].push([A[parseInt(a)-1].clone(),A[parseInt(b)-1].clone(),A[parseInt(c)-1].clone()])}function r(a,b,c){void 0===a[3]?(k(a[0],a[1],a[2],c),void 0!==b&&0<b.length&&l(b[0],b[1],b[2])):(void 0!==c&&0<c.length?(k(a[0],a[1],a[3],[c[0],c[1],c[3]]),k(a[1],a[2],a[3],[c[1],c[2],c[3]])):(k(a[0],a[1],
a[3]),k(a[1],a[2],a[3])),void 0!==b&&0<b.length&&(l(b[0],b[1],b[3]),l(b[1],b[2],b[3])))}for(var h=0,p=new THREE.Group,t=p,m=new THREE.Geometry,v=new THREE.MeshLambertMaterial,g=new THREE.Mesh(m,v),u=[],F=[],A=[],z=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,D=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,M=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,n=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,C=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,O=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,
L=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,G=a.split("\n"),I=0;I<G.length;I++){var y=G[I],y=y.trim(),q;0!==y.length&&"#"!==y.charAt(0)&&(null!==(q=z.exec(y))?u.push(c(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]))):null!==(q=D.exec(y))?F.push(c(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]))):null!==(q=M.exec(y))?A.push(e(parseFloat(q[1]),parseFloat(q[2]))):null!==(q=n.exec(y))?r([q[1],q[2],q[3],q[4]]):null!==(q=C.exec(y))?r([q[2],q[5],q[8],q[11]],[q[3],
q[6],q[9],q[12]]):null!==(q=O.exec(y))?r([q[2],q[6],q[10],q[14]],[q[3],q[7],q[11],q[15]],[q[4],q[8],q[12],q[16]]):null!==(q=L.exec(y))?r([q[2],q[5],q[8],q[11]],[],[q[3],q[6],q[9],q[12]]):/^o /.test(y)?(d(),h+=u.length,u=[],t=new THREE.Object3D,t.name=y.substring(2).trim(),p.add(t)):/^g /.test(y)?d(y.substring(2).trim(),void 0):/^usemtl /.test(y)?d(void 0,y.substring(7).trim()):/^mtllib /.test(y)?b&&(y=y.substring(7),y=y.trim(),b(y)):/^s /.test(y)||console.log("THREE.OBJMTLLoader: Unhandled line "+
y))}d(void 0,void 0);return p}};THREE.EventDispatcher.prototype.apply(THREE.OBJMTLLoader.prototype);THREE.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.renderOrder=this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.renderOrder=this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};
THREE.Projector=function(){function a(){if(t===v){var a=new THREE.RenderableVertex;m.push(a);v++;t++;return a}return m[t++]}function b(){if(u===A){var a=new THREE.RenderableFace;F.push(a);A++;u++;return a}return F[u++]}function c(){if(D===n){var a=new THREE.RenderableLine;M.push(a);n++;D++;return a}return M[D++]}function e(){if(O===G){var a=new THREE.RenderableSprite;L.push(a);G++;O++;return a}return L[O++]}function f(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?
b.z-a.z:a.id!==b.id?a.id-b.id:0}function d(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(0<=e&&0<=f&&0<=g&&0<=h)return!0;if(0>e&&0>f||0>g&&0>h)return!1;0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h)));if(d<c)return!1;a.lerp(b,c);b.lerp(a,1-d);return!0}var k,l,r=[],h=0,p,t,m=[],v=0,g,u,F=[],A=0,z,D,M=[],n=0,C,O,L=[],G=0,I={objects:[],lights:[],elements:[]},y=new THREE.Vector3,q=new THREE.Vector4,E=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),w=new THREE.Box3,K=Array(3),V=new THREE.Matrix4,Q=new THREE.Matrix4,J,U=new THREE.Matrix4,aa=new THREE.Matrix3,R=new THREE.Frustum,X=new THREE.Vector4,ca=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var P=new function(){function d(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(J);c.copy(b).applyMatrix4(Q);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z}function e(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;K[0]=a.positionScreen;K[1]=b.positionScreen;K[2]=c.positionScreen;return E.intersectsBox(w.setFromPoints(K))}function f(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-
(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)}var h=[],k=[],l=null,t=null,r=new THREE.Matrix3;return{setObject:function(a){l=a;t=l.material;r.getNormalMatrix(l.matrixWorld);h.length=0;k.length=0},projectVertex:d,checkTriangleVisibility:e,checkBackfaceCulling:f,pushVertex:function(b,c,e){p=a();p.position.set(b,c,e);d(p)},pushNormal:function(a,b,c){h.push(a,b,c)},pushUv:function(a,b){k.push(a,b)},pushLine:function(a,b){var d=m[a],e=m[b];z=c();z.id=l.id;z.v1.copy(d);
z.v2.copy(e);z.z=(d.positionScreen.z+e.positionScreen.z)/2;z.renderOrder=l.renderOrder;z.material=l.material;I.elements.push(z)},pushTriangle:function(a,c,d){var n=m[a],q=m[c],p=m[d];if(!1!==e(n,q,p)&&(t.side===THREE.DoubleSide||!0===f(n,q,p))){g=b();g.id=l.id;g.v1.copy(n);g.v2.copy(q);g.v3.copy(p);g.z=(n.positionScreen.z+q.positionScreen.z+p.positionScreen.z)/3;g.renderOrder=l.renderOrder;g.normalModel.fromArray(h,3*a);g.normalModel.applyMatrix3(r).normalize();for(n=0;3>n;n++)q=g.vertexNormalsModel[n],
q.fromArray(h,3*arguments[n]),q.applyMatrix3(r).normalize(),g.uvs[n].fromArray(k,2*arguments[n]);g.vertexNormalsLength=3;g.material=l.material;I.elements.push(g)}}}};this.projectScene=function(n,p,v,E){function F(a){if(l===h){var b=new THREE.RenderableObject;r.push(b);h++;l++;k=b}else k=r[l++];k.id=a.id;k.object=a;y.setFromMatrixPosition(a.matrixWorld);y.applyProjection(Q);k.z=y.z;k.renderOrder=a.renderOrder;I.objects.push(k)}O=D=u=0;I.elements.length=0;!0===n.autoUpdate&&n.updateMatrixWorld();null===
p.parent&&p.updateMatrixWorld();V.copy(p.matrixWorldInverse.getInverse(p.matrixWorld));Q.multiplyMatrices(p.projectionMatrix,V);R.setFromMatrix(Q);l=0;I.objects.length=0;I.lights.length=0;n.traverseVisible(function(a){a instanceof THREE.Light?I.lights.push(a):a instanceof THREE.Mesh||a instanceof THREE.Line?!1===a.material.visible||!0===a.frustumCulled&&!1===R.intersectsObject(a)||F(a):a instanceof THREE.Sprite&&!1!==a.material.visible&&(!0!==a.frustumCulled||!1!==R.intersectsSprite(a))&&F(a)});!0===
v&&I.objects.sort(f);n=0;for(v=I.objects.length;n<v;n++){var B=I.objects[n].object,w=B.geometry;P.setObject(B);J=B.matrixWorld;t=0;if(B instanceof THREE.Mesh)if(w instanceof THREE.BufferGeometry){var A=w.attributes,B=w.groups;if(void 0!==A.position){for(var H=A.position.array,x=0,N=H.length;x<N;x+=3)P.pushVertex(H[x],H[x+1],H[x+2]);if(void 0!==A.normal)for(var L=A.normal.array,x=0,N=L.length;x<N;x+=3)P.pushNormal(L[x],L[x+1],L[x+2]);if(void 0!==A.uv)for(A=A.uv.array,x=0,N=A.length;x<N;x+=2)P.pushUv(A[x],
A[x+1]);if(null!==w.index)if(H=w.index.array,0<B.length)for(n=0;n<B.length;n++)for(N=B[n],x=N.start,N=N.start+N.count;x<N;x+=3)P.pushTriangle(H[x],H[x+1],H[x+2]);else for(x=0,N=H.length;x<N;x+=3)P.pushTriangle(H[x],H[x+1],H[x+2]);else for(x=0,N=H.length/3;x<N;x+=3)P.pushTriangle(x,x+1,x+2)}}else{if(w instanceof THREE.Geometry){var G=w.vertices,x=w.faces,N=w.faceVertexUvs[0];aa.getNormalMatrix(J);for(var H=B.material,A=H instanceof THREE.MultiMaterial,L=!0===A?B.material:null,K=0,M=G.length;K<M;K++){var ba=
G[K];y.copy(ba);if(!0===H.morphTargets)for(var S=w.morphTargets,W=B.morphTargetInfluences,T=0,Y=S.length;T<Y;T++){var da=W[T];if(0!==da){var Z=S[T].vertices[K];y.x+=(Z.x-ba.x)*da;y.y+=(Z.y-ba.y)*da;y.z+=(Z.z-ba.z)*da}}P.pushVertex(y.x,y.y,y.z)}G=0;for(K=x.length;G<K;G++)if(M=x[G],H=!0===A?L.materials[M.materialIndex]:B.material,void 0!==H&&(W=H.side,w=m[M.a],ba=m[M.b],S=m[M.c],!1!==P.checkTriangleVisibility(w,ba,S))){T=P.checkBackfaceCulling(w,ba,S);if(W!==THREE.DoubleSide){if(W===THREE.FrontSide&&
!1===T)continue;if(W===THREE.BackSide&&!0===T)continue}g=b();g.id=B.id;g.v1.copy(w);g.v2.copy(ba);g.v3.copy(S);g.normalModel.copy(M.normal);!1!==T||W!==THREE.BackSide&&W!==THREE.DoubleSide||g.normalModel.negate();g.normalModel.applyMatrix3(aa).normalize();Y=M.vertexNormals;da=0;for(Z=Math.min(Y.length,3);da<Z;da++){var ea=g.vertexNormalsModel[da];ea.copy(Y[da]);!1!==T||W!==THREE.BackSide&&W!==THREE.DoubleSide||ea.negate();ea.applyMatrix3(aa).normalize()}g.vertexNormalsLength=Y.length;W=N[G];if(void 0!==
W)for(T=0;3>T;T++)g.uvs[T].copy(W[T]);g.color=M.color;g.material=H;g.z=(w.positionScreen.z+ba.positionScreen.z+S.positionScreen.z)/3;g.renderOrder=B.renderOrder;I.elements.push(g)}}}else if(B instanceof THREE.Line)if(w instanceof THREE.BufferGeometry){if(A=w.attributes,void 0!==A.position){H=A.position.array;x=0;for(N=H.length;x<N;x+=3)P.pushVertex(H[x],H[x+1],H[x+2]);if(null!==w.index)for(H=w.index.array,x=0,N=H.length;x<N;x+=2)P.pushLine(H[x],H[x+1]);else for(A=B instanceof THREE.LineSegments?2:
1,x=0,N=H.length/3-1;x<N;x+=A)P.pushLine(x,x+1)}}else{if(w instanceof THREE.Geometry&&(U.multiplyMatrices(Q,J),G=B.geometry.vertices,0!==G.length))for(w=a(),w.positionScreen.copy(G[0]).applyMatrix4(U),A=B instanceof THREE.LineSegments?2:1,K=1,M=G.length;K<M;K++)w=a(),w.positionScreen.copy(G[K]).applyMatrix4(U),0<(K+1)%A||(ba=m[t-2],X.copy(w.positionScreen),ca.copy(ba.positionScreen),!0===d(X,ca)&&(X.multiplyScalar(1/X.w),ca.multiplyScalar(1/ca.w),z=c(),z.id=B.id,z.v1.positionScreen.copy(X),z.v2.positionScreen.copy(ca),
z.z=Math.max(X.z,ca.z),z.renderOrder=B.renderOrder,z.material=B.material,B.material.vertexColors===THREE.VertexColors&&(z.vertexColors[0].copy(B.geometry.colors[K]),z.vertexColors[1].copy(B.geometry.colors[K-1])),I.elements.push(z)))}else B instanceof THREE.Sprite&&(q.set(J.elements[12],J.elements[13],J.elements[14],1),q.applyMatrix4(Q),x=1/q.w,q.z*=x,-1<=q.z&&1>=q.z&&(C=e(),C.id=B.id,C.x=q.x*x,C.y=q.y*x,C.z=q.z,C.renderOrder=B.renderOrder,C.object=B,C.rotation=B.rotation,C.scale.x=B.scale.x*Math.abs(C.x-
(q.x+p.projectionMatrix.elements[0])/(q.w+p.projectionMatrix.elements[12])),C.scale.y=B.scale.y*Math.abs(C.y-(q.y+p.projectionMatrix.elements[5])/(q.w+p.projectionMatrix.elements[13])),C.material=B.material,I.elements.push(C)))}!0===E&&I.elements.sort(f);return I}};THREE.BrightnessContrastShader={uniforms:{tDiffuse:{type:"t",value:null},brightness:{type:"f",value:0},contrast:{type:"f",value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb += brightness;\nif (contrast > 0.0) {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n} else {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n}\n}"};THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"};THREE.EffectComposer=function(a,b){this.renderer=a;if(void 0===b){var c={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},e=a.getSize();b=new THREE.WebGLRenderTarget(e.width,e.height,c)}this.renderTarget1=b;this.renderTarget2=b.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader");this.copyPass=new THREE.ShaderPass(THREE.CopyShader)};
Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=a},addPass:function(a){this.passes.push(a);var b=this.renderer.getSize();a.setSize(b.width,b.height)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){var b=!1,c,e,f=this.passes.length;for(e=0;e<f;e++)if(c=this.passes[e],!1!==c.enabled){c.render(this.renderer,this.writeBuffer,this.readBuffer,a,b);if(c.needsSwap){if(b){var d=this.renderer.context;
d.stencilFunc(d.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a);d.stencilFunc(d.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(c instanceof THREE.MaskPass?b=!0:c instanceof THREE.ClearMaskPass&&(b=!1))}},reset:function(a){if(void 0===a){var b=this.renderer.getSize();a=this.renderTarget1.clone();a.setSize(b.width,b.height)}this.renderTarget1.dispose();this.renderTarget2.dispose();this.renderTarget1=a;this.renderTarget2=a.clone();this.writeBuffer=
this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(a,b){this.renderTarget1.setSize(a,b);this.renderTarget2.setSize(a,b);for(var c=0;c<this.passes.length;c++)this.passes[c].setSize(a,b)}});THREE.Pass=function(){this.needsSwap=this.enabled=!0;this.renderToScreen=this.clear=!1};Object.assign(THREE.Pass.prototype,{setSize:function(a,b){},render:function(a,b,c,e,f){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = rgbA;\n} else {\ngl_FragColor = rgbB;\n}\n}"};THREE.MaskPass=function(a,b){THREE.Pass.call(this);this.scene=a;this.camera=b;this.clear=!0;this.inverse=this.needsSwap=!1};
THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(a,b,c,e,f){e=a.context;f=a.state;f.buffers.color.setMask(!1);f.buffers.depth.setMask(!1);f.buffers.color.setLocked(!0);f.buffers.depth.setLocked(!0);var d,k;this.inverse?(d=0,k=1):(d=1,k=0);f.buffers.stencil.setTest(!0);f.buffers.stencil.setOp(e.REPLACE,e.REPLACE,e.REPLACE);f.buffers.stencil.setFunc(e.ALWAYS,d,4294967295);f.buffers.stencil.setClear(k);a.render(this.scene,this.camera,
c,this.clear);a.render(this.scene,this.camera,b,this.clear);f.buffers.color.setLocked(!1);f.buffers.depth.setLocked(!1);f.buffers.stencil.setFunc(e.EQUAL,1,4294967295);f.buffers.stencil.setOp(e.KEEP,e.KEEP,e.KEEP)}});THREE.ClearMaskPass=function(){THREE.Pass.call(this);this.needsSwap=!1};THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype);Object.assign(THREE.ClearMaskPass.prototype,{render:function(a,b,c,e,f){a.state.buffers.stencil.setTest(!1)}});THREE.ShaderLib.mirror={uniforms:{mirrorColor:{type:"c",value:new THREE.Color(8355711)},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:new THREE.Matrix4}},vertexShader:"uniform mat4 textureMatrix;\nvarying vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarying vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);\ngl_FragColor = color;\n}"};
THREE.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;c=c||{};this.matrixNeedsUpdate=!0;var e=void 0!==c.textureWidth?c.textureWidth:512,f=void 0!==c.textureHeight?c.textureHeight:512;this.clipBias=void 0!==c.clipBias?c.clipBias:0;var d=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.renderer=a;this.mirrorPlane=new THREE.Plane;this.normal=new THREE.Vector3(0,0,1);this.mirrorWorldPosition=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;
this.rotationMatrix=new THREE.Matrix4;this.lookAtPosition=new THREE.Vector3(0,0,-1);this.clipPlane=new THREE.Vector4;void 0!==c.debugMode&&c.debugMode&&(a=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),c=new THREE.Geometry,c.vertices.push(new THREE.Vector3(-10,-10,0)),c.vertices.push(new THREE.Vector3(10,-10,0)),c.vertices.push(new THREE.Vector3(10,10,0)),c.vertices.push(new THREE.Vector3(-10,10,0)),c.vertices.push(c.vertices[0]),c=new THREE.Line(c,new THREE.LineBasicMaterial({color:16777088})),
this.add(a),this.add(c));b instanceof THREE.PerspectiveCamera?this.camera=b:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!"));this.textureMatrix=new THREE.Matrix4;this.mirrorCamera=this.camera.clone();this.texture=new THREE.WebGLRenderTarget(e,f);this.tempTexture=new THREE.WebGLRenderTarget(e,f);b=THREE.ShaderLib.mirror;a=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,
uniforms:a});this.material.uniforms.mirrorSampler.value=this.texture;this.material.uniforms.mirrorColor.value=d;this.material.uniforms.textureMatrix.value=this.textureMatrix;THREE.Math.isPowerOfTwo(e)&&THREE.Math.isPowerOfTwo(f)||(this.texture.generateMipmaps=!1,this.tempTexture.generateMipmaps=!1);this.updateTextureMatrix();this.render()};THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype);THREE.Mirror.prototype.constructor=THREE.Mirror;
THREE.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};
THREE.Mirror.prototype.updateTextureMatrix=function(){this.updateMatrixWorld();this.camera.updateMatrixWorld();this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld);this.rotationMatrix.extractRotation(this.matrixWorld);this.normal.set(0,0,1);this.normal.applyMatrix4(this.rotationMatrix);var a=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);a.reflect(this.normal).negate();a.add(this.mirrorWorldPosition);
this.rotationMatrix.extractRotation(this.camera.matrixWorld);this.lookAtPosition.set(0,0,-1);this.lookAtPosition.applyMatrix4(this.rotationMatrix);this.lookAtPosition.add(this.cameraWorldPosition);var b=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);b.reflect(this.normal).negate();b.add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.rotationMatrix);this.up.reflect(this.normal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);
this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition);this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse);
this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);b=new THREE.Vector4;a=this.mirrorCamera.projectionMatrix;b.x=(Math.sign(this.clipPlane.x)+a.elements[8])/a.elements[0];b.y=(Math.sign(this.clipPlane.y)+a.elements[9])/a.elements[5];b.z=-1;b.w=(1+a.elements[10])/a.elements[14];new THREE.Vector4;b=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(b));a.elements[2]=b.x;a.elements[6]=b.y;a.elements[10]=b.z+1-this.clipBias;a.elements[14]=
b.w};THREE.Mirror.prototype.render=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix();this.matrixNeedsUpdate=!0;for(var a=this;void 0!==a.parent;)a=a.parent;void 0!==a&&a instanceof THREE.Scene&&this.renderer.render(a,this.mirrorCamera,this.texture,!0)};
THREE.Mirror.prototype.renderTemp=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix();this.matrixNeedsUpdate=!0;for(var a=this;void 0!==a.parent;)a=a.parent;void 0!==a&&a instanceof THREE.Scene&&this.renderer.render(a,this.mirrorCamera,this.tempTexture,!0)};THREE.MirrorShader={uniforms:{tDiffuse:{type:"t",value:null},side:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform int side;\nvarying vec2 vUv;\nvoid main() {\nvec2 p = vUv;\nif (side == 0){\nif (p.x > 0.5) p.x = 1.0 - p.x;\n}else if (side == 1){\nif (p.x < 0.5) p.x = 1.0 - p.x;\n}else if (side == 2){\nif (p.y < 0.5) p.y = 1.0 - p.y;\n}else if (side == 3){\nif (p.y > 0.5) p.y = 1.0 - p.y;\n} \nvec4 color = texture2D(tDiffuse, p);\ngl_FragColor = color;\n}"};THREE.RenderPass=function(a,b,c,e,f){THREE.Pass.call(this);this.scene=a;this.camera=b;this.overrideMaterial=c;this.clearColor=e;this.clearAlpha=void 0!==f?f:0;this.clear=!0;this.needsSwap=this.clearDepth=!1};
THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(a,b,c,e,f){b=a.autoClear;a.autoClear=!1;this.scene.overrideMaterial=this.overrideMaterial;var d,k;this.clearColor&&(d=a.getClearColor().getHex(),k=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha));this.clearDepth&&a.clearDepth();a.render(this.scene,this.camera,this.renderToScreen?null:c,this.clear);this.clearColor&&a.setClearColor(d,k);this.scene.overrideMaterial=
null;a.autoClear=b}});THREE.ShaderGodRays={godrays_generate:{uniforms:{tInput:{type:"t",value:null},fStepSize:{type:"f",value:1},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define TAPS_PER_PASS 6.0\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 vSunPositionScreenSpace;\nuniform float fStepSize;\nvoid main() {\nvec2 delta = vSunPositionScreenSpace - vUv;\nfloat dist = length( delta );\nvec2 stepv = fStepSize * delta / dist;\nfloat iters = dist/fStepSize;\nvec2 uv = vUv.xy;\nfloat col = 0.0;\nif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\nif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\nif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\nif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\nif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\nif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;\nuv += stepv;\ngl_FragColor = vec4( col/TAPS_PER_PASS );\ngl_FragColor.a = 1.0;\n}"},
godrays_combine:{uniforms:{tColors:{type:"t",value:null},tGodRays:{type:"t",value:null},fGodRayIntensity:{type:"f",value:.69},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColors;\nuniform sampler2D tGodRays;\nuniform vec2 vSunPositionScreenSpace;\nuniform float fGodRayIntensity;\nvoid main() {\ngl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );\ngl_FragColor.a = 1.0;\n}"},
godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)},fAspect:{type:"f",value:1},sunColor:{type:"c",value:new THREE.Color(16772608)},bgColor:{type:"c",value:new THREE.Color(0)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform vec2 vSunPositionScreenSpace;\nuniform float fAspect;\nuniform vec3 sunColor;\nuniform vec3 bgColor;\nvoid main() {\nvec2 diff = vUv - vSunPositionScreenSpace;\ndiff.x *= fAspect;\nfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );\nprop = 0.35 * pow( 1.0 - prop, 3.0 );\ngl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );\ngl_FragColor.w = 1.0;\n}"}};var SPE=SPE||{};
SPE.utils={randomVector3:function(a,b){var c=new THREE.Vector3;return c.copy(a),c.x+=Math.random()*b.x-b.x/2,c.y+=Math.random()*b.y-b.y/2,c.z+=Math.random()*b.z-b.z/2,c},randomColor:function(a,b){var c=new THREE.Color;return c.copy(a),c.r+=Math.random()*b.x-b.x/2,c.g+=Math.random()*b.y-b.y/2,c.b+=Math.random()*b.z-b.z/2,c.r=Math.max(0,Math.min(c.r,1)),c.g=Math.max(0,Math.min(c.g,1)),c.b=Math.max(0,Math.min(c.b,1)),c},randomFloat:function(a,b){return a+b*(Math.random()-.5)},randomVector3OnSphere:function(a,b,
c,e,f){var d=2*Math.random()-1,k=6.2832*Math.random(),l=Math.sqrt(1-d*d),d=new THREE.Vector3(l*Math.cos(k),l*Math.sin(k),d);b=this._randomFloat(b,c);return f&&(b=Math.round(b/f)*f),d.multiplyScalar(b),e&&d.multiply(e),d.add(a),d},randomVector3OnDisk:function(a,b,c,e,f){var d=6.2832*Math.random();b=this._randomFloat(b,c);f&&(b=Math.round(b/f)*f);f=(new THREE.Vector3(Math.cos(d),Math.sin(d),0)).multiplyScalar(b);return e&&f.multiply(e),f.add(a),f},randomVelocityVector3OnSphere:function(a,b,c,e,f){a=
(new THREE.Vector3).subVectors(a,b);return a.normalize().multiplyScalar(Math.abs(this._randomFloat(c,e))),f&&a.multiply(f),a},randomizeExistingVector3:function(a,b,c){a.copy(b);a.x+=Math.random()*c.x-c.x/2;a.y+=Math.random()*c.y-c.y/2;a.z+=Math.random()*c.z-c.z/2},randomizeExistingColor:function(a,b,c){a.copy(b);a.r+=Math.random()*c.x-c.x/2;a.g+=Math.random()*c.y-c.y/2;a.b+=Math.random()*c.z-c.z/2;a.r=Math.max(0,Math.min(a.r,1));a.g=Math.max(0,Math.min(a.g,1));a.b=Math.max(0,Math.min(a.b,1))},randomizeExistingVector3OnSphere:function(a,
b,c,e,f,d){var k=2*Math.random()-1,l=6.2832*Math.random(),r=Math.sqrt(1-k*k);c=this._randomFloat(c,e);d&&(c=Math.round(c/d)*d);a.set(r*Math.cos(l)*c,r*Math.sin(l)*c,k*c).multiply(f);a.add(b)},randomizeExistingVector3OnDisk:function(a,b,c,e,f,d){var k=6.2832*Math.random();c=Math.abs(this._randomFloat(c,e));d&&(c=Math.round(c/d)*d);a.set(Math.cos(k),Math.sin(k),0).multiplyScalar(c);f&&a.multiply(f);a.add(b)},randomizeExistingVelocityVector3OnSphere:function(a,b,c,e,f){a.copy(c).sub(b).normalize().multiplyScalar(Math.abs(this._randomFloat(e,
f)))},generateID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}};SPE=SPE||{};
SPE.Group=function(a){this.fixedTimeStep=parseFloat("number"==typeof a.fixedTimeStep?a.fixedTimeStep:.016);this.maxAge=parseFloat(a.maxAge||3);this.texture=a.texture||null;this.hasPerspective=parseInt("number"==typeof a.hasPerspective?a.hasPerspective:1,10);this.colorize=parseInt("number"==typeof a.colorize?a.colorize:1,10);this.blending="number"==typeof a.blending?a.blending:THREE.AdditiveBlending;this.transparent="number"==typeof a.transparent?a.transparent:1;this.alphaTest="number"==typeof a.alphaTest?
a.alphaTest:.5;this.depthWrite=a.depthWrite||!1;this.depthTest=a.depthTest||!0;this.uniforms={duration:{type:"f",value:this.maxAge},texture:{type:"t",value:this.texture},hasPerspective:{type:"i",value:this.hasPerspective},colorize:{type:"i",value:this.colorize}};this.attributes={acceleration:{type:"v3",value:[]},velocity:{type:"v3",value:[]},alive:{type:"f",value:[]},age:{type:"f",value:[]},size:{type:"v3",value:[]},angle:{type:"v4",value:[]},colorStart:{type:"c",value:[]},colorMiddle:{type:"c",value:[]},
colorEnd:{type:"c",value:[]},opacity:{type:"v3",value:[]}};this.emitters=[];this._pool=[];this._poolCreationSettings=null;this._createNewWhenPoolEmpty=0;this.maxAgeMilliseconds=1E3*this.maxAge;this.geometry=new THREE.Geometry;this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,attributes:this.attributes,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest});
this.mesh=new THREE.PointCloud(this.geometry,this.material);this.mesh.dynamic=!0};
SPE.Group.prototype={_flagUpdate:function(){return this.attributes.age.needsUpdate=!0,this.attributes.alive.needsUpdate=!0,this.attributes.angle.needsUpdate=!0,this.attributes.velocity.needsUpdate=!0,this.attributes.acceleration.needsUpdate=!0,this.geometry.verticesNeedUpdate=!0,this},addEmitter:function(a){a.particlesPerSecond=a.duration?a.particleCount/(this.maxAge<a.duration?this.maxAge:a.duration)|0:a.particleCount/this.maxAge|0;var b=this.geometry.vertices,c=b.length,e=a.particleCount+c,f=this.attributes,
d=f.acceleration.value,k=f.velocity.value,l=f.alive.value,r=f.age.value,h=f.size.value,p=f.angle.value,t=f.colorStart.value,m=f.colorMiddle.value,v=f.colorEnd.value,g=f.opacity.value;a.particleIndex=parseFloat(c);for(var u=c;e>u;++u)"sphere"===a.type?(b[u]=this._randomVector3OnSphere(a.position,a.radius,a.radiusSpread,a.radiusScale,a.radiusSpreadClamp),k[u]=this._randomVelocityVector3OnSphere(b[u],a.position,a.speed,a.speedSpread)):"disk"===a.type?(b[u]=this._randomVector3OnDisk(a.position,a.radius,
a.radiusSpread,a.radiusScale,a.radiusSpreadClamp),k[u]=this._randomVelocityVector3OnSphere(b[u],a.position,a.speed,a.speedSpread)):(b[u]=this._randomVector3(a.position,a.positionSpread),k[u]=this._randomVector3(a.velocity,a.velocitySpread)),d[u]=this._randomVector3(a.acceleration,a.accelerationSpread),h[u]=new THREE.Vector3(Math.abs(this._randomFloat(a.sizeStart,a.sizeStartSpread)),Math.abs(this._randomFloat(a.sizeMiddle,a.sizeMiddleSpread)),Math.abs(this._randomFloat(a.sizeEnd,a.sizeEndSpread))),
p[u]=new THREE.Vector4(this._randomFloat(a.angleStart,a.angleStartSpread),this._randomFloat(a.angleMiddle,a.angleMiddleSpread),this._randomFloat(a.angleEnd,a.angleEndSpread),a.angleAlignVelocity?1:0),r[u]=0,l[u]=a.isStatic?1:0,t[u]=this._randomColor(a.colorStart,a.colorStartSpread),m[u]=this._randomColor(a.colorMiddle,a.colorMiddleSpread),v[u]=this._randomColor(a.colorEnd,a.colorEndSpread),g[u]=new THREE.Vector3(Math.abs(this._randomFloat(a.opacityStart,a.opacityStartSpread)),Math.abs(this._randomFloat(a.opacityMiddle,
a.opacityMiddleSpread)),Math.abs(this._randomFloat(a.opacityEnd,a.opacityEndSpread)));return a.verticesIndex=parseFloat(c),a.attributes=f,a.vertices=this.geometry.vertices,a.maxAge=this.maxAge,a.__id=this._generateID(),a.isStatic||this.emitters.push(a),this},removeEmitter:function(a){var b=this.emitters;if(a instanceof SPE.Emitter)a=a.__id;else if("string"!=typeof a)return void console.warn("Invalid emitter or emitter ID passed to SPE.Group#removeEmitter.");for(var c=0,e=b.length;e>c;++c)if(b[c].__id===
a){b.splice(c,1);break}},tick:function(a){var b=this.emitters,c=b.length;if(a=a||this.fixedTimeStep,0!==c){for(var e=0;c>e;++e)b[e].tick(a);return this._flagUpdate(),this}},getFromPool:function(){var a=this._pool,b=this._createNewWhenPoolEmpty;return a.length?a.pop():b?new SPE.Emitter(this._poolCreationSettings):null},releaseIntoPool:function(a){return a instanceof SPE.Emitter?(a.reset(),this._pool.unshift(a),this):void console.error("Will not add non-emitter to particle group pool:",a)},getPool:function(){return this._pool},
addPool:function(a,b,c){this._poolCreationSettings=b;this._createNewWhenPoolEmpty=!!c;for(var e=0;a>e;++e)c=new SPE.Emitter(b),this.addEmitter(c),this.releaseIntoPool(c);return this},_triggerSingleEmitter:function(a){var b=this,c=b.getFromPool();return null===c?void console.log("SPE.Group pool ran out."):(a&&c.position.copy(a),c.enable(),setTimeout(function(){c.disable();b.releaseIntoPool(c)},b.maxAgeMilliseconds),b)},triggerPoolEmitter:function(a,b){if("number"==typeof a&&1<a)for(var c=0;a>c;++c)this._triggerSingleEmitter(b);
else this._triggerSingleEmitter(b);return this}};for(var i in SPE.utils)SPE.Group.prototype["_"+i]=SPE.utils[i];
SPE.shaders={vertex:"uniform float duration;\nuniform int hasPerspective;\nattribute vec3 colorStart;\nattribute vec3 colorMiddle;\nattribute vec3 colorEnd;\nattribute vec3 opacity;\nattribute vec3 acceleration;\nattribute vec3 velocity;\nattribute float alive;\nattribute float age;\nattribute vec3 size;\nattribute vec4 angle;\nvarying vec4 vColor;\nvarying float vAngle;\nvec4 GetPos() {\nvec3 newPos = vec3( position );\nvec3 a = acceleration * age;\nvec3 v = velocity * age;\nv = v + (a * age);\nnewPos = newPos + v;\nvec4 mvPosition = modelViewMatrix * vec4( newPos, 1.0 );\nreturn mvPosition;\n}\nvoid main() {\nfloat positionInTime = (age / duration);\nfloat lerpAmount1 = (age / (0.5 * duration));\nfloat lerpAmount2 = ((age - 0.5 * duration) / (0.5 * duration));\nfloat halfDuration = duration / 2.0;\nfloat pointSize = 0.0;\nvAngle = 0.0;\nif( alive > 0.5 ) {\nif( positionInTime < 0.5 ) {\nvColor = vec4( mix(colorStart, colorMiddle, lerpAmount1), mix(opacity.x, opacity.y, lerpAmount1) );\n}\nelse {\nvColor = vec4( mix(colorMiddle, colorEnd, lerpAmount2), mix(opacity.y, opacity.z, lerpAmount2) );\n}\nvec4 pos = GetPos();\nif( angle[3] == 1.0 ) {\nvAngle = -atan(pos.y, pos.x);\n}\nelse if( positionInTime < 0.5 ) {\nvAngle = mix( angle.x, angle.y, lerpAmount1 );\n}\nelse {\nvAngle = mix( angle.y, angle.z, lerpAmount2 );\n}\nif( positionInTime < 0.5) {\npointSize = mix( size.x, size.y, lerpAmount1 );\n}\nelse {\npointSize = mix( size.y, size.z, lerpAmount2 );\n}\nif( hasPerspective == 1 ) {\npointSize = pointSize * ( 300.0 / length( pos.xyz ) );\n}\ngl_PointSize = pointSize;\ngl_Position = projectionMatrix * pos;\n}\nelse {\nvColor = vec4( 0.0, 0.0, 0.0, 0.0 );\ngl_Position = vec4(1000000000.0, 1000000000.0, 1000000000.0, 0.0);\n}\n}",fragment:"uniform sampler2D texture;\nuniform int colorize;\nvarying vec4 vColor;\nvarying float vAngle;\nvoid main() {\nfloat c = cos(vAngle);\nfloat s = sin(vAngle);\nvec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,\nc * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);\nvec4 rotatedTexture = texture2D( texture, rotatedUV );\nif( colorize == 1 ) {\ngl_FragColor = vColor * rotatedTexture;\n}\nelse {\ngl_FragColor = rotatedTexture;\n}\n}"};
SPE=SPE||{};
SPE.Emitter=function(a){a=a||{};this.particleCount="number"==typeof a.particleCount?a.particleCount:100;this.type="cube"===a.type||"sphere"===a.type||"disk"===a.type?a.type:"cube";this.position=a.position instanceof THREE.Vector3?a.position:new THREE.Vector3;this.positionSpread=a.positionSpread instanceof THREE.Vector3?a.positionSpread:new THREE.Vector3;this.radius="number"==typeof a.radius?a.radius:10;this.radiusSpread="number"==typeof a.radiusSpread?a.radiusSpread:0;this.radiusScale=a.radiusScale instanceof
THREE.Vector3?a.radiusScale:new THREE.Vector3(1,1,1);this.radiusSpreadClamp="number"==typeof a.radiusSpreadClamp?a.radiusSpreadClamp:0;this.acceleration=a.acceleration instanceof THREE.Vector3?a.acceleration:new THREE.Vector3;this.accelerationSpread=a.accelerationSpread instanceof THREE.Vector3?a.accelerationSpread:new THREE.Vector3;this.velocity=a.velocity instanceof THREE.Vector3?a.velocity:new THREE.Vector3;this.velocitySpread=a.velocitySpread instanceof THREE.Vector3?a.velocitySpread:new THREE.Vector3;
this.speed=parseFloat("number"==typeof a.speed?a.speed:0);this.speedSpread=parseFloat("number"==typeof a.speedSpread?a.speedSpread:0);this.sizeStart=parseFloat("number"==typeof a.sizeStart?a.sizeStart:1);this.sizeStartSpread=parseFloat("number"==typeof a.sizeStartSpread?a.sizeStartSpread:0);this.sizeEnd=parseFloat("number"==typeof a.sizeEnd?a.sizeEnd:this.sizeStart);this.sizeEndSpread=parseFloat("number"==typeof a.sizeEndSpread?a.sizeEndSpread:0);this.sizeMiddle=parseFloat("undefined"!=typeof a.sizeMiddle?
a.sizeMiddle:Math.abs(this.sizeEnd+this.sizeStart)/2);this.sizeMiddleSpread=parseFloat("number"==typeof a.sizeMiddleSpread?a.sizeMiddleSpread:0);this.angleStart=parseFloat("number"==typeof a.angleStart?a.angleStart:0);this.angleStartSpread=parseFloat("number"==typeof a.angleStartSpread?a.angleStartSpread:0);this.angleEnd=parseFloat("number"==typeof a.angleEnd?a.angleEnd:0);this.angleEndSpread=parseFloat("number"==typeof a.angleEndSpread?a.angleEndSpread:0);this.angleMiddle=parseFloat("undefined"!=
typeof a.angleMiddle?a.angleMiddle:Math.abs(this.angleEnd+this.angleStart)/2);this.angleMiddleSpread=parseFloat("number"==typeof a.angleMiddleSpread?a.angleMiddleSpread:0);this.angleAlignVelocity=a.angleAlignVelocity||!1;this.colorStart=a.colorStart instanceof THREE.Color?a.colorStart:new THREE.Color("white");this.colorStartSpread=a.colorStartSpread instanceof THREE.Vector3?a.colorStartSpread:new THREE.Vector3;this.colorEnd=a.colorEnd instanceof THREE.Color?a.colorEnd:this.colorStart.clone();this.colorEndSpread=
a.colorEndSpread instanceof THREE.Vector3?a.colorEndSpread:new THREE.Vector3;this.colorMiddle=a.colorMiddle instanceof THREE.Color?a.colorMiddle:(new THREE.Color).addColors(this.colorStart,this.colorEnd).multiplyScalar(.5);this.colorMiddleSpread=a.colorMiddleSpread instanceof THREE.Vector3?a.colorMiddleSpread:new THREE.Vector3;this.opacityStart=parseFloat("undefined"!=typeof a.opacityStart?a.opacityStart:1);this.opacityStartSpread=parseFloat("undefined"!=typeof a.opacityStartSpread?a.opacityStartSpread:
0);this.opacityEnd=parseFloat("number"==typeof a.opacityEnd?a.opacityEnd:0);this.opacityEndSpread=parseFloat("undefined"!=typeof a.opacityEndSpread?a.opacityEndSpread:0);this.opacityMiddle=parseFloat("undefined"!=typeof a.opacityMiddle?a.opacityMiddle:Math.abs(this.opacityEnd+this.opacityStart)/2);this.opacityMiddleSpread=parseFloat("number"==typeof a.opacityMiddleSpread?a.opacityMiddleSpread:0);this.duration="number"==typeof a.duration?a.duration:null;this.alive=parseFloat("number"==typeof a.alive?
a.alive:1);this.isStatic="number"==typeof a.isStatic?a.isStatic:0;this.particlesPerSecond=0;this.vertices=this.attributes=null;this.particleIndex=this.maxAge=this.age=this.verticesIndex=0;this.__id=null;this.userData={}};
SPE.Emitter.prototype={_resetParticle:function(a){var b=this.type,c=this.positionSpread,e=this.vertices[a],f=this.attributes.velocity.value[a],d=this.velocitySpread,k=this.accelerationSpread;"cube"===b&&0===c.x&&0===c.y&&0===c.z||"sphere"===b&&0===this.radius||"disk"===b&&0===this.radius?(e.copy(this.position),this._randomizeExistingVector3(f,this.velocity,d),"cube"===b&&this._randomizeExistingVector3(this.attributes.acceleration.value[a],this.acceleration,k)):"cube"===b?(this._randomizeExistingVector3(e,
this.position,c),this._randomizeExistingVector3(f,this.velocity,d),this._randomizeExistingVector3(this.attributes.acceleration.value[a],this.acceleration,k)):"sphere"===b?(this._randomizeExistingVector3OnSphere(e,this.position,this.radius,this.radiusSpread,this.radiusScale,this.radiusSpreadClamp),this._randomizeExistingVelocityVector3OnSphere(f,this.position,e,this.speed,this.speedSpread)):"disk"===b&&(this._randomizeExistingVector3OnDisk(e,this.position,this.radius,this.radiusSpread,this.radiusScale,
this.radiusSpreadClamp),this._randomizeExistingVelocityVector3OnSphere(f,this.position,e,this.speed,this.speedSpread))},tick:function(a){if(!this.isStatic){for(var b=this.attributes,c=b.alive.value,b=b.age.value,e=this.verticesIndex,f=this.particleCount,d=e+f,k=this.particlesPerSecond*this.alive*a,l=this.maxAge,r=this.age,h=this.duration,p=this.particleIndex,t=e;d>t;++t)1===c[t]&&(b[t]+=a),b[t]>=l&&(b[t]=0,c[t]=0);if(0===this.alive)return void(this.age=0);if("number"==typeof h&&r>h)return this.alive=
0,void(this.age=0);d=Math.max(Math.min(d,p+k),0);l=h=0;for(t=r=0|p;d>t;++t)1!==c[t]&&++h;if(0!==h)for(h=a/h,t=r;d>t;++t,++l)1!==c[t]&&(c[t]=1,b[t]=h*l,this._resetParticle(t));this.particleIndex+=k;0>this.particleIndex&&(this.particleIndex=0);p>=e+f&&(this.particleIndex=parseFloat(e));this.age+=a;0>this.age&&(this.age=0)}},reset:function(a){if(this.age=0,this.alive=0,a){a=this.verticesIndex+this.particleCount;for(var b=this.attributes,c=b.alive.value,b=b.age.value,e=this.verticesIndex;a>e;++e)c[e]=
0,b[e]=0}return this},enable:function(){this.alive=1},disable:function(){this.alive=0}};for(i in SPE.utils)SPE.Emitter.prototype["_"+i]=SPE.utils[i];THREE.ShaderPass=function(a,b){THREE.Pass.call(this);this.textureID=void 0!==b?b:"tDiffuse";a instanceof THREE.ShaderMaterial?(this.uniforms=a.uniforms,this.material=a):a&&(this.uniforms=Object.assign({},a.uniforms),this.material=new THREE.ShaderMaterial({defines:a.defines||{},uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}));this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,
2),null);this.scene.add(this.quad)};THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(a,b,c,e,f){this.uniforms[this.textureID]&&(this.uniforms[this.textureID]=new THREE.Uniform(c.texture));this.quad.material=this.material;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}});THREE.ShaderLib.sky={uniforms:{luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},sunPosition:{type:"v3",value:new THREE.Vector3}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D skySampler;\nuniform vec3 sunPosition;\nvarying vec3 vWorldPosition;\nvec3 cameraPos = vec3(0., 0., 0.);\n// uniform sampler2D sDiffuse;\n// const float turbidity = 10.0; //\n// const float reileigh = 2.; //\n// const float luminance = 1.0; //\n// const float mieCoefficient = 0.005;\n// const float mieDirectionalG = 0.8;\nuniform float luminance;\nuniform float turbidity;\nuniform float reileigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\n// constants for atmospheric scattering\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\nconst float n = 1.0003; // refractive index of air\nconst float N = 2.545E25; // number of molecules per unit volume for air at\n// 288.15K and 1013mb (sea level -45 celsius)\nconst float pn = 0.035;\t// depolatization factor for standard air\n// wavelength of used primaries, according to preetham\nconst vec3 lambda = vec3(680E-9, 550E-9, 450E-9);\n// mie stuff\n// K coefficient for the primaries\nconst vec3 K = vec3(0.686, 0.678, 0.666);\nconst float v = 4.0;\n// optical length at zenith for molecules\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3(0.0, 1.0, 0.0);\nconst float EE = 1000.0;\nconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n// 66 arc seconds -> degrees, and the cosine of that\n// earth shadow hack\nconst float cutoffAngle = pi/1.95;\nconst float steepness = 1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));\n}\n// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005 / vec3(94, 40, 18);\n}\nfloat rayleighPhase(float cosTheta)\n{\t \nreturn (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n//\treturn (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n//\treturn (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));\n}\nvec3 totalMie(vec3 lambda, vec3 K, float T)\n{\nfloat c = (0.2 * T ) * 10E-18;\nreturn 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;\n}\nfloat hgPhase(float cosTheta, float g)\n{\nreturn (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));\n}\n// float logLuminance(vec3 c)\n// {\n// \treturn log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);\n// }\n// Filmic ToneMapping http://filmicgames.com/archives/75\nfloat A = 0.15;\nfloat B = 0.50;\nfloat C = 0.10;\nfloat D = 0.20;\nfloat E = 0.02;\nfloat F = 0.30;\nfloat W = 1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\nvoid main() \n{\nfloat sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\n// luminance =  1.0 ;// vWorldPosition.y / 450000. + 0.5; //sunPosition.y / 450000. * 1. + 0.5;\n// gl_FragColor = vec4(sunfade, sunfade, sunfade, 1.0);\nfloat reileighCoefficient = reileigh - (1.0* (1.0-sunfade));\nvec3 sunDirection = normalize(sunPosition);\nfloat sunE = sunIntensity(dot(sunDirection, up));\n// extinction (absorbtion + out scattering) \n// rayleigh coefficients\nvec3 betaR = simplifiedRayleigh() * reileighCoefficient;\n// mie coefficients\nvec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;\n// optical length\n// cutoff angle at 90 to avoid singularity in next formula.\nfloat zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));\nfloat sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\nfloat sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\n// combined extinction factor\t\nvec3 Fex = exp(-(betaR * sR + betaM * sM));\n// in scattering\nfloat cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);\nfloat rPhase = rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta = betaR * rPhase;\nfloat mPhase = hgPhase(cosTheta, mieDirectionalG);\nvec3 betaMTheta = betaM * mPhase;\nvec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));\nLin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));\n//nightsky\nvec3 direction = normalize(vWorldPosition - cameraPos);\nfloat theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]\nfloat phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]\nvec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);\n// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;\nvec3 L0 = vec3(0.1) * Fex;\n// composition + solar disc\n//if (cosTheta > sunAngularDiameterCos)\nfloat sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\n// if (normalize(vWorldPosition - cameraPos).y>0.0)\nL0 += (sunE * 19000.0 * Fex)*sundisk;\nvec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor = (Lin+L0);   \ntexColor *= 0.04 ;\ntexColor += vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance = 1.0;\nfloat fLumScaled = 0.1 / luminance;     \nfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); \nfloat ExposureBias = fLumCompressed;\nvec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 color = curr*whiteScale;\nvec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));\ngl_FragColor.rgb = retColor;\ngl_FragColor.a = 1.0;\n}"};
THREE.Sky=function(){var a=THREE.ShaderLib.sky,b=THREE.UniformsUtils.clone(a.uniforms),a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:b,side:THREE.BackSide}),c=new THREE.SphereBufferGeometry(45E4,32,15);this.mesh=new THREE.Mesh(c,a);this.uniforms=b};THREE.SSAOShader={uniforms:{tDiffuse:{value:null},tDepth:{value:null},size:{value:new THREE.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},onlyAO:{value:0},aoClamp:{value:.5},lumInfluence:{value:.5}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\nuniform bool onlyAO;\nuniform vec2 size;\nuniform float aoClamp;\nuniform float lumInfluence;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nconst int samples = 8;\nconst float radius = 5.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0003;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\n#include <packing>\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );\nfloat gg = fract( coord.t * ( size.y / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat readDepth( const in vec2 coord ) {\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nreturn cameraCoef / ( cameraFarPlusNear - unpackRGBAToDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / size.x )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat ao = 0.0;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\nfloat pw = cos( l ) * r;\nfloat ph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"};window.ThreeBSP=function(){var a;a=function(b){var c,e,f,d,k,l,r,h=[];if(b instanceof THREE.Geometry)this.matrix=new THREE.Matrix4;else if(b instanceof THREE.Mesh)b.updateMatrix(),this.matrix=b.matrix.clone(),b=b.geometry;else{if(b instanceof a.Node)return this.tree=b,this.matrix=new THREE.Matrix4,this;throw"ThreeBSP: Given geometry is unsupported";}c=0;for(e=b.faces.length;c<e;c++){f=b.faces[c];k=b.faceVertexUvs[0][c];r=new a.Polygon;if(f instanceof THREE.Face3)d=b.vertices[f.a],l=k?new THREE.Vector2(k[0].x,
k[0].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[0],l),d.applyMatrix4(this.matrix),r.vertices.push(d),d=b.vertices[f.b],l=k?new THREE.Vector2(k[1].x,k[1].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[2],l),d.applyMatrix4(this.matrix),r.vertices.push(d),d=b.vertices[f.c],l=k?new THREE.Vector2(k[2].x,k[2].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[2],l),d.applyMatrix4(this.matrix),r.vertices.push(d);else if(typeof THREE.Face4)d=b.vertices[f.a],l=k?new THREE.Vector2(k[0].x,k[0].y):
null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[0],l),d.applyMatrix4(this.matrix),r.vertices.push(d),d=b.vertices[f.b],l=k?new THREE.Vector2(k[1].x,k[1].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[1],l),d.applyMatrix4(this.matrix),r.vertices.push(d),d=b.vertices[f.c],l=k?new THREE.Vector2(k[2].x,k[2].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[2],l),d.applyMatrix4(this.matrix),r.vertices.push(d),d=b.vertices[f.d],l=k?new THREE.Vector2(k[3].x,k[3].y):null,d=new a.Vertex(d.x,d.y,d.z,f.vertexNormals[3],
l),d.applyMatrix4(this.matrix),r.vertices.push(d);else throw"Invalid face type at index "+c;r.calculateProperties();h.push(r)}this.tree=new a.Node(h)};a.prototype.subtract=function(b){var c=this.tree.clone();b=b.tree.clone();c.invert();c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();c.build(b.allPolygons());c.invert();c=new a(c);c.matrix=this.matrix;return c};a.prototype.union=function(b){var c=this.tree.clone();b=b.tree.clone();c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();
c.build(b.allPolygons());c=new a(c);c.matrix=this.matrix;return c};a.prototype.intersect=function(b){var c=this.tree.clone();b=b.tree.clone();c.invert();b.clipTo(c);b.invert();c.clipTo(b);b.clipTo(c);c.build(b.allPolygons());c.invert();c=new a(c);c.matrix=this.matrix;return c};a.prototype.toGeometry=function(){var a,c,e=(new THREE.Matrix4).getInverse(this.matrix),f=new THREE.Geometry,d=this.tree.allPolygons(),k=d.length,l,r,h={},p,t,m,v;for(a=0;a<k;a++)for(l=d[a],r=l.vertices.length,c=2;c<r;c++)v=
[],m=l.vertices[0],v.push(new THREE.Vector2(m.uv.x,m.uv.y)),m=new THREE.Vector3(m.x,m.y,m.z),m.applyMatrix4(e),"undefined"!==typeof h[m.x+","+m.y+","+m.z]?p=h[m.x+","+m.y+","+m.z]:(f.vertices.push(m),p=h[m.x+","+m.y+","+m.z]=f.vertices.length-1),m=l.vertices[c-1],v.push(new THREE.Vector2(m.uv.x,m.uv.y)),m=new THREE.Vector3(m.x,m.y,m.z),m.applyMatrix4(e),"undefined"!==typeof h[m.x+","+m.y+","+m.z]?t=h[m.x+","+m.y+","+m.z]:(f.vertices.push(m),t=h[m.x+","+m.y+","+m.z]=f.vertices.length-1),m=l.vertices[c],
v.push(new THREE.Vector2(m.uv.x,m.uv.y)),m=new THREE.Vector3(m.x,m.y,m.z),m.applyMatrix4(e),"undefined"!==typeof h[m.x+","+m.y+","+m.z]?m=h[m.x+","+m.y+","+m.z]:(f.vertices.push(m),m=h[m.x+","+m.y+","+m.z]=f.vertices.length-1),p=new THREE.Face3(p,t,m,new THREE.Vector3(l.normal.x,l.normal.y,l.normal.z)),f.faces.push(p),f.faceVertexUvs[0].push(v);return f};a.prototype.toMesh=function(a){var b=this.toGeometry();a=new THREE.Mesh(b,a);a.position.setFromMatrixPosition(this.matrix);a.rotation.setFromRotationMatrix(this.matrix);
return a};a.Polygon=function(a,c,e){a instanceof Array||(a=[]);this.vertices=a;0<a.length?this.calculateProperties():this.normal=this.w=void 0};a.Polygon.prototype.calculateProperties=function(){var a=this.vertices[0],c=this.vertices[2];this.normal=this.vertices[1].clone().subtract(a).cross(c.clone().subtract(a)).normalize();this.w=this.normal.clone().dot(a);return this};a.Polygon.prototype.clone=function(){var b,c,e=new a.Polygon;b=0;for(c=this.vertices.length;b<c;b++)e.vertices.push(this.vertices[b].clone());
e.calculateProperties();return e};a.Polygon.prototype.flip=function(){var a,c=[];this.normal.multiplyScalar(-1);this.w*=-1;for(a=this.vertices.length-1;0<=a;a--)c.push(this.vertices[a]);this.vertices=c;return this};a.Polygon.prototype.classifyVertex=function(a){a=this.normal.dot(a)-this.w;return-1E-5>a?2:1E-5<a?1:0};a.Polygon.prototype.classifySide=function(a){var b,e,f=0,d=0,k=a.vertices.length;for(b=0;b<k;b++)e=a.vertices[b],e=this.classifyVertex(e),1===e?f++:2===e&&d++;return 0<f&&0===d?1:0===
f&&0<d?2:0===f&&0===d?0:3};a.Polygon.prototype.splitPolygon=function(b,c,e,f,d){var k=this.classifySide(b);if(0===k)(0<this.normal.dot(b.normal)?c:e).push(b);else if(1===k)f.push(b);else if(2===k)d.push(b);else{var l,r,h,p,k=[],t=[];e=0;for(c=b.vertices.length;e<c;e++)l=(e+1)%c,p=b.vertices[e],l=b.vertices[l],r=this.classifyVertex(p),h=this.classifyVertex(l),2!=r&&k.push(p),1!=r&&t.push(p),3===(r|h)&&(r=(this.w-this.normal.dot(p))/this.normal.dot(l.clone().subtract(p)),p=p.interpolate(l,r),k.push(p),
t.push(p));3<=k.length&&f.push((new a.Polygon(k)).calculateProperties());3<=t.length&&d.push((new a.Polygon(t)).calculateProperties())}};a.Vertex=function(a,c,e,f,d){this.x=a;this.y=c;this.z=e;this.normal=f||new THREE.Vector3;this.uv=d||new THREE.Vector2};a.Vertex.prototype.clone=function(){return new a.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())};a.Vertex.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};a.Vertex.prototype.subtract=function(a){this.x-=
a.x;this.y-=a.y;this.z-=a.z;return this};a.Vertex.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};a.Vertex.prototype.cross=function(a){var b=this.x,e=this.y,f=this.z;this.x=e*a.z-f*a.y;this.y=f*a.x-b*a.z;this.z=b*a.y-e*a.x;return this};a.Vertex.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x/=a;this.y/=a;this.z/=a;return this};a.Vertex.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};a.Vertex.prototype.lerp=
function(a,c){this.add(a.clone().subtract(this).multiplyScalar(c));this.normal.add(a.normal.clone().sub(this.normal).multiplyScalar(c));this.uv.add(a.uv.clone().sub(this.uv).multiplyScalar(c));return this};a.Vertex.prototype.interpolate=function(a,c){return this.clone().lerp(a,c)};a.Vertex.prototype.applyMatrix4=function(a){var b=this.x,e=this.y,f=this.z;a=a.elements;this.x=a[0]*b+a[4]*e+a[8]*f+a[12];this.y=a[1]*b+a[5]*e+a[9]*f+a[13];this.z=a[2]*b+a[6]*e+a[10]*f+a[14];return this};a.Node=function(b){var c,
e,f=[],d=[];this.polygons=[];this.front=this.back=void 0;if(b instanceof Array&&0!==b.length){this.divider=b[0].clone();c=0;for(e=b.length;c<e;c++)this.divider.splitPolygon(b[c],this.polygons,this.polygons,f,d);0<f.length&&(this.front=new a.Node(f));0<d.length&&(this.back=new a.Node(d))}};a.Node.isConvex=function(a){var b,e;for(b=0;b<a.length;b++)for(e=0;e<a.length;e++)if(b!==e&&2!==a[b].classifySide(a[e]))return!1;return!0};a.Node.prototype.build=function(b){var c,e,f=[],d=[];this.divider||(this.divider=
b[0].clone());c=0;for(e=b.length;c<e;c++)this.divider.splitPolygon(b[c],this.polygons,this.polygons,f,d);0<f.length&&(this.front||(this.front=new a.Node),this.front.build(f));0<d.length&&(this.back||(this.back=new a.Node),this.back.build(d))};a.Node.prototype.allPolygons=function(){var a=this.polygons.slice();this.front&&(a=a.concat(this.front.allPolygons()));this.back&&(a=a.concat(this.back.allPolygons()));return a};a.Node.prototype.clone=function(){var b=new a.Node;b.divider=this.divider.clone();
b.polygons=this.polygons.map(function(a){return a.clone()});b.front=this.front&&this.front.clone();b.back=this.back&&this.back.clone();return b};a.Node.prototype.invert=function(){var a,c;a=0;for(c=this.polygons.length;a<c;a++)this.polygons[a].flip();this.divider.flip();this.front&&this.front.invert();this.back&&this.back.invert();a=this.front;this.front=this.back;this.back=a;return this};a.Node.prototype.clipPolygons=function(a){var b,e,f,d;if(!this.divider)return a.slice();f=[];d=[];b=0;for(e=a.length;b<
e;b++)this.divider.splitPolygon(a[b],f,d,f,d);this.front&&(f=this.front.clipPolygons(f));d=this.back?this.back.clipPolygons(d):[];return f.concat(d)};a.Node.prototype.clipTo=function(a){this.polygons=a.clipPolygons(this.polygons);this.front&&this.front.clipTo(a);this.back&&this.back.clipTo(a)};return a}();
